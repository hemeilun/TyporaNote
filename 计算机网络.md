

# 计算机网络 

<br/>

## （一）计算机网络体系结构

<br/>

### 1.概念，组成，功能和分类

<br/>

#### （1）概念

<br/>

计算机网络：是将分散的和具有独立功能的计算机系统，通过通信设备和线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。

简述：计算机网络是自治的，互连的计算机集合。

互连：互联互通

自治：无主从关系

<br/><br/><br/>

#### （2）功能

<br/>

主要功能：数据通信，资源共享

其他功能：分布式处理（多台计算机承担同一工作的不同部分），提高可靠性（在一台出现问题后存在替代机），负载均衡

<br/><br/><br/>

#### （3）组成

<br/>

组成部分：硬件，软件和协议

<br/>

工作方式：

- 边缘部分：用户直接使用的部分

  ​                  存在两种方式：C/S方式，P2P方式

- 核心部分：为边缘部分服务

<br/>

功能组成：

- 通信子网：实现数据通信
- 资源子网：实现资源共享/数据处理

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet.png" alt="image-20211025164540828" style="zoom:67%;" />

<br/>

上三层是资源子网：实现资源共享功能的设备和软件的集合

运输层是上下两个子网的接口

下三层是通信子网：各种传输介质，通信设备，相应的协议组成

<br/><br/><br/>

#### （4）分类

<br/>

按分布范围分：

- 广域网WAN（交换技术）
- 城域网MAN
- 局域网WAN（广播技术）
- 个人区域网PAN

<br/>

按使用者分：

- 公用网：中国电信等
- 专用网：军队网络等

<br/>

按交换技术分：

- 电路技术
- 报文技术
- 分组交换

<br/>

按拓扑结构分：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet2.png" alt="image-20211025165410928" style="zoom:80%;" />

<br/>

按传输技术分：

- 广播式网络：共享公共通信网络，谁能能听到，但是只有叫的人回答
- 点对点网络

<br/><br/><br/><br/><br/>

### 2.标准化工作和相关组织

<br/>

#### （1）标准的分类

<br/>

分类：

- 法定标准：由权威机构制定的正式的，合法的标准
- 事实标准：某些公司的产品在竞争中占据了主流，时间长了这些产品中的协议和技术就成为了标准

<br/><br/><br/>

#### （2）RFC发展为因特网标准的四个阶段

<br/>

RFC：因特网标准形式

<br/>

四个阶段：

1）因特网草案：这个阶段还不是RFC文档

2）建议标准：从这个阶段成为RFC文档

3）草案标准：提交给IETF，IAB审核

4）成为因特网标准

在后续发展中，第三个阶段被取消

<br/><br/><br/>

#### （3）相关组织

<br/>

国际标准化组织ISO

国际电信联盟ITU

国际电气电子工程师协会IEEE

internet工程任务组IETF

<br/><br/><br/><br/><br/>

###  3.速率相关的性能指标

<br/>

#### （1）速率

<br/>

速率是数据率或称数据传输率或比特率，即连接在计算机网络主机在数字信道上传输数据位数的速率。

单位是：b/s，kb/s，Mb/s，Gb/s，Tb/s

<br/>

单位转换：

1kb/s=10^3b/s

1Mb/s=10^3kb/s

1Gb/s=10^3Mb/s

存储容量单位关系转换是1024

1KB=2^10B=1024*8b

1MB=2^10KB

<br/><br/><br/><br/>

#### （2）带宽

<br/>

（这个是在别的科目中的定义）带宽原本是指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹（Hz）

<br/>

（这是计网中的定义）

带宽用来表示网络的通信线路传送数据的能力，通常是指单位时间内从一点到另一点所能通过的最高速率。

通俗来说就是：从主机到链路入口为发送数据的速率，而不是在链路中传输的速率。所以一般都达不到带宽。

单位是：b/s，kb/s，Mb/s，Gb/s，Tb/s

例如：链路带宽=1Mb/s，主机在1us内可向链路发送1bit数据

<br/><br/><br/><br/>

#### （3）吞吐量

<br/>

表示在单位时间内通过某个网路（或信道，接口）的数据量。

单位：b/s，kb/s,Mb/s

吞吐量受网络的带宽或网络的额定速率的限制。

<br/>

比如：

我能够在1s内吃100碗饭，甲每秒给我乘10碗，乙每秒给我乘20碗，这时我的带宽是100碗/s，而吞吐量是30碗/s.

<br/><br/><br/><br/>

#### （4）时延

<br/>

定义：指数据（报文，分组，比特流）从网络（或链路）的一端传到另一端所需的时间。也叫延迟或迟延。单位s

时延包含四部分（四个部分加起来才是真的时延）：

- 发送时延：从发送分组的第一个比特算起，到最后一个比特发送完成所需的时间

  ​                 计算公式：发送时延 = 数据长度 / 信道带宽

- 传播时延：数据在链路上的传播时间

  ​                  计算公式：传播时延 = 链路长度 /  电磁波速率

- 排队时延：等待 输出 / 输入 链路可用的时间

- 处理时延：检错，找出口所需的时间

<br/><br/><br/><br/>

#### （5）时延带宽积

<br/>

时延带宽积即某段链路现在有多少比特，又称以比特为单位的链路长度

就是发送端一直发送数据，直到把链路充满，里面可以放多少比特的数据

计算公式：时延带宽积 = 传播时延 X  带宽

<br/><br/><br/><br/>

#### （6）往返时延RTT

<br/>

定义：从发送方发送数据开始，到发送方收到接收方的确认（接受方收到数据后立即发送数据），总共经历的时延。

就是数据传输一个来回，要经历的一个时间。

<br/>

RTT包括：

- 往返传输时延 = 传播时延 X 2
-  末端处理时间

<br/><br/><br/><br/>

#### （7）利用率

<br/>

信道利用率 = 有数据通过的时间 /  （有+无）数据通过时间

网络利用率：信道利用率加权平均值

<br/><br/><br/><br/>

### 4.分层结构，协议，接口，服务

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet3.png" alt="image-20211026142015941" style="zoom:67%;" />

<br/>

#### （1）分层的原因

<br/>

发送文件前要完成的工作：

- 发起通信的计算机必须将数据通信的通路进行激活
- 要告诉网络如何实现目的主机
- 发起通信的计算机要查明目的主机是否开机，并且与网络连接正常
- 发起通信的计算机要查明目的主机的文件管理程序是否已经做好准备工作
- 确保差错和意外可以解决
- .......

<br/>

**原因**：计算机网路中的各种任务是一个非常复杂的过程，我们需要通过分层来将复杂的过程化为一个个简单的小问题，每层逐步进行解决

<br/><br/><br/><br/>

#### （2）分层的基本原则

- 各层之间相互独立，每层只实现一个相对独立的功能
- 每层之间界面自然清晰，易于理解，相互交流尽可能少
- 结构上可分割开，每层都是用最合适的技术实现
- 保证下层对上层的独立性，上层单向使用下层提供的服务
- 整个分层结构应该能促进标准化工作

<br/><br/><br/><br/>

#### （3）几个概念

实体：第n层中活动的元素叫做 **n层实体** ，同一层的实体叫做 **对等实体**

<br/>

协议：为进行网络中 **对等实体** 之间的数据交换而建立的规则、标准或约定成为网络协议

- 语法：规定传输数据的格式
- 语义：规定所要完成的功能
- 同步：规定各种操作的顺序

<br/>

服务：下层为相邻上层提供的功能调用

​          每个中间层为上层提供服务的同时使用下面所有层次的服务

<br/>

各层之间的数据包含关系：上一层传递的PDU作为下一层的SDU整合上下一层的PCI成为心得PDU，在以同样的方式传递给下一层作为SDU

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet4.png" alt="image-20211026143117640" style="zoom:80%;" />

<br/>

SDU（服务数据单元）：为完成用户所需要的功能而应传送的数据

PCI（协议控制信息）：控制协议操作的信息

PDU（协议数据单元）：对等层次之间传送的数据单位

<br/><br/><br/><br/>

#### （4）一些总结

<br/>

网络体系结构是从 **功能** 上描述计算机网络结构

计算机网络体系结构是 **分层结构**

每层遵循某个/些网络协议完成本层的功能

计算机网路体系结构是计算机网络的 **各层及其协议** 的集合

第 n 层在向 n+1 层提供服务时，此服务不仅包含第 n 层本身的功能，还包含由下层服务提供的功能

仅仅在相邻层间有接口，且所提供服务的具体细节对上一层完全屏蔽

体系结构是 **抽象** 的，而实现是指一些能够运行的一些硬件和软件

<br/><br/><br/><br/><br/>

### 5.OSI参考模型

<br/>

#### （1）图示

<br/>

ISO：国际标准化组织

注：

七层：物联网淑慧试用（物链网输会示用）

H是加在数据 **头** 上,下面加 H 的是数据的头部

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet5.png" alt="image-20211026151234879" style="zoom: 50%;" />

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet6.png" alt="image-20211026151353355" style="zoom:50%;" />

<br/><br/><br/><br/>

#### （2）各层概述

<br/>

##### ① 应用层

<br/>

内容：所有能和用户交互产生流量的程序

典型的应用层服务：文件传输（FTP），电子邮件（SMTP），万维网（HTTP）

<br/><br/><br/>

##### ② 表示层

<br/>

内容：用于处理在两个通信系统中交换信息的表达式

功能：

- 数据格式交换（翻译官）
- 数据加密
- 数据压缩和恢复

<br/><br/><br/>

##### ③ 会话层

<br/>

内容：向表示层实体/用户进程提供 **建立连接** 并在连接上**有序**地**传输**数据，这是会话，也是 **建立同步**

功能：

- 建立，管理，终止会话
- 使用校验点可使会话在通信失效时，从校验点继续回复通信，实现数据同步（适用传输大文件）

<br/><br/><br/>

##### ④ 传输层

<br/>

内容：负责主机两个进程的通信，即端到端的通信。

传输单位是报文段或用户数据报

功能：

- 可靠传输（传输数据时，需要接受方的确认消息才继续发送，长时间无确认消息就重发），不可靠传输（没有确认消息不管收没收到都一直发）
- 差错控制（对是否有错误进行检测并纠错）
- 流量控制（对传输的快慢进行控制）
- 复用（多个应用层进程同时使用下面运输层的服务），分用（运输层把收到到的消息分别交付给上面应用层相应的进程）

<br/><br/><br/>

##### ⑤ 网络层

<br/>

内容：主要是把分组从源端传输到目的端，为分组交换网上不同主机提供通信服务。

网络层传输单位是数据报

功能：

- 路由选择（选择最佳路径）
- 流量控制（控制传输快慢）
- 差错控制
- 拥塞控制（若所有结点都来不及接受分组，而要丢弃大量分组的话网络就处于拥塞状态，因此要采取一定的措施缓解这种拥塞）

<br/><br/><br/>

##### ⑥ 数据链路层

<br/>

内容：主要任务是把网络层传输下来的数据包组装成帧。

数据链路层的传输单位是帧

 功能；

- 成帧（定义帧的开始和结束）
- 差错控制（帧错+位错）
- 流量控制
- 访问（接入）控制

<br/><br/><br/>

##### ⑦ 物理层

<br/>

内容：主要任务是把物理媒体上实现比特流的透明传输

物理层传输单位是比特

透明传输：指不管传输的数据是什么样的比特流组合，都应能在链路上传送

功能：

- 定义接口特性（比如说电缆插头有几个引脚）
- 定义传输模式（单工：传输方向固定）（半双工：都可以是接受方和发送方，但同一时间只能有一个在发送）（双工：可以同时接收和发送）
- 定义传输速率
- 比特同步
- 比特编码

<br/><br/><br/><br/><br/>

### 6.TCP/IP参考模型和五层参考模型

<br/>

#### （1）结构图

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet7.png" alt="image-20211026213208076" style="zoom:50%;" />

<br/>

TCP/IP是先有协议，在更具OSI模型总结出的参考模型

<br/><br/><br/>

#### （2）OSI和TCP/IP的相同与不同

<br/>

相同：

- 都分层
- 基于独立协议栈概念
- 可以实现异构网络连接

<br/>

不同：

- OSI定义三点：服务，协议，端口

- OSI先出现，参考模型先于协议发明，不偏向特定协议

- TCP/IP设计之初就想到了异构互联网问题，将IP作为重要层次

- |        | ISO/OSI参考模型 | TCP/IP参考模型  |
  | ------ | --------------- | --------------- |
  | 网络层 | 无连接+面向连接 | 无连接          |
  | 传输层 | 面向连接        | 无连接+面向连接 |

  

面向连接：分为三个阶段，第一阶段是建立连接，在此阶段，发出一个建立连接的请求。第二阶段，只有在建立之后，才可以传输数据。第三阶段，当传输完毕，必须释放连接。

无连接：直接进行数据传输

<br/><br/><br/>

#### （3）五层参考模型

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet8.png" alt="image-20211026214624675" style="zoom: 50%;" />

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet9.png" alt="image-20211026214711223" style="zoom:50%;" />

<br/><br/><br/><br/><br/><br/><br/><br/>

## （二）物理层

<br/>

### 1.基本概念

<br/>

物理层解决**如何**在连接各种计算机的传输媒体上**传输数据比特流**，而不是指具体的传输媒体

物理层的主要任务：确定与传输媒体接口有关的一些特性。

一些特性：

- 机械特性：定义物理连接的特性，规定物理连接时所采用的规格，接口形状，引线数目，引脚数量和排列情况

- 电气特性：规定二进制传输时，先例上信号的电压范围，阻抗匹配，传输速率和距离限制等

  ​                如：某网络物理层规定，信号的电平用+10V~+15V表示二进制0，-10V~-15V表示二进制1，电线长度限于15m以内

- 功能特性：指明某条线路上出现的某一电平表示何种意义，接口部件的信号线的用途

- 规程特性（过程特性）：规定各条物理线路的工作规程和时序关系

<br/><br/><br/><br/><br/>

### 2.数据通信基础知识

<br/>

#### （1）典型的数据通信模型

<br/>

![image-20211027161655414](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet10.png)

<br/><br/><br/><br/>

#### （2）数据通信相关术语

<br/>

通信的目的是 传输信息

数据：传输信号的实体，通常是有意义的符号序列

信号：数据的电气或电磁表现，是数据在传输过程中的存在形式

- 数字信号：代表信息的参考取值是离散的
- 模拟信号：代表信息的参数是连续的

信源：产生和发送数据的源头

信宿：接收数据的终点

<br/>

信道：信号的传输介质（信道是有方向的）。一般用来表示向一个方向传送信息的介质，因此一条通信线路往往包含一条发送信息和一条接收信道。

信道分类：

按传输信号：

- 模拟信道（传送模拟信号）
- 数字信道（传送数字信号）

按传输介质：

- 无线信道
- 有线信道

<br/><br/><br/><br/>

#### （3）通信方式

<br/>

从通信双方信息的交互方式看，可以有三种基本方式：

单工通信：只有一个方向的通信而没有反方向的交互，仅需要一条信道

半双工通信：通信的双方都可以发送或接收消息，但是在同一时间，双方都不能同时发送和接收，需要两条信道。

全双工通信：通信双方可以同时接收和发送消息，需要两条信道

<br/><br/><br/><br/>

#### （4）数据传输方式

<br/>

串行传输：速度慢，费用低，适合远距离

并行传输：速度快，费用高，适合近距离

<br/><br/><br/><br/>

#### （5）码元

<br/>

码元是指 用一个固定时长的信号波形（数字脉冲），代表不同离散值的基本波形，是数字系统中数字信号的计量单位，这个时长内的信号称为码元宽度。

当码元的离散状态有M个时，就称之为M进制码元。

1码元可以携带多个比特的信息量。例如：在使用二进制编码时，一种代表0状态，另一种代表1状态。

<br/>

![image-20211027181134396](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet11.png)

<br/>

K进制码元：比如四进制码元，就是指码元的离散状态有4个（4种高低不同的信号波形），用比特表示就是 00，01，10，11

<br/><br/><br/><br/>

#### （6）速率和波特

<br/>

定义：速率也叫数据率，是指数据的传输速率，表示单位时间内传输的数据量，可以用码元传输速率和信息传输速率表示。

注：传播速率：指数据在链路上的传输速率。而这里的速率是指从发送数据到链路上的速率。

<br/>

码元传输速率：（别名：码元速率，波形速率，调制速率，符号速率等），他表示单位时间内数字通信系统所传输的码元个数（也可称为脉冲个数或信息变化的次数），单位是 **波特（Baud）**。

1波特表示数字通信系统每秒传输一个码元。这里的码元可以时多进制的，也可以是二进制的，但码元速率与进制数无关。

<br/>

信息传输速率：（别名：信息速率，比特率等），表示单位时间内数字通信系统传输二进制码元个数（就是比特数），单位：比特/秒(b/s)

<br/>

关系：若一个码元携带n比特的信息量，则M Baud的码元所对应的传输速率为 M X n bit/s

带宽：就是在第一章中速率传输指标内的带宽

<br/><br/><br/><br/><br/>

### 3.奈氏准则和香农定理

<br/>

在一个问题中如果同时出现信噪比，几进制码元就要用两个公式都算一下，去小的那个。

<br/>

#### （1）失真

<br/>

定义：信号在传输过程中信号受损

影响失真程度的因素：码元传输速率，信号传输距离，噪声干扰，传输媒体质量

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet12.png" alt="image-20211028153912062" style="zoom:50%;" />

<br/><br/><br/><br/>

#### （2）码间串扰

<br/>

定义：接收端收到的信号波形失去了码元之间清晰界限的现象

<br/>

信道带宽：信道能通过最高频率与最低频率之差。

<br/><br/><br/><br/>

#### （3）奈氏准则（奈奎斯特定理）

<br/>

定义：在理想低通（无噪声，宽带受限）的条件下，为了避免码间串扰，极限码元传输速率为 **2W Baud**，W是信道带宽，单位是Hz。

（只有在奈氏准则和香农定理中带宽单位才是Hz）

<br/>

理想低通信道的极限数据传输速率：

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/conpunet13.png" alt="image-20211028154817416" style="zoom:67%;" />

<br/>

W：带宽 

V：几种码元/码元的离散电频数目

<br/>

注：

- 奈氏准则给出了码元传输速率的限制，但是并没有对信息的传输速率给出限制
- 在任何信道中，码元传输的速率都是有上限的。如果超出上限就会出现码间串扰的问题，使接收端对码元的完全正确识别成为不可能
- 信道的频带越宽（即能通过的信号高频分量越多），就可以以更高的速率进行码元的有效传输
- 由于码元的传输速率受奈氏准则的制约，要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法

<br/><br/><br/><br/>

#### （4）信噪比

<br/>

噪声存在于所有电子设备和通信信道中，由于噪声随机产生，它的瞬间值有时会很大，因此噪声会使接收端对码的判断产生错误。但是噪声的影响是相对的，若信号较强，那噪声的影响就相对较小。所以，信噪比很重要。

**信噪比 = 信号的平均功率 /  噪声的平均功率**，常记为S/N，并用分贝（dB）作为单位

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet14.png" alt="image-20211028160944917" style="zoom: 67%;" />

<br/><br/><br/><br/>

#### （5）香农定理

<br/>

定义：在宽带受限且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet15.png" alt="image-20211028161044844" style="zoom:80%;" />

<br/>

注：

- 信号的带宽或信道中信噪比越大，则信息的极限传输速率就越高
- 对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了
- 只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输
- 香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少

<br/><br/><br/><br/><br/>

### 4.编码与调制

<br/>

#### （1）基带信号和宽带信号

<br/>

**基带信号：**来自信源的信号。基带信号就是发出的直接表达了要传输信息的信号。像是计算机输出的代表各种文字或图像文件的数据信号属于基带信号。

**宽带信号：**将基带信号进行载波调制后，把信号的频率范围移到较高的频段以便在信道中传输。

<br/>

**基带传输：**将数字信号1和0直接用两种不同的电压表示，在送到**数字信道**上去传输。

**宽带传输：**将基带信号进行调制后形成的频分复用和模拟信号，再传送到**模拟信道**上去传输。

<br/>

在传输距离较近时，使用基带传输。

在传输距离较远时，采用宽带传输。

<br/><br/><br/><br/>

#### （2）数字数据编码为数字信号

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet16.png" alt="image-20211028184111035" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet17.png" alt="image-20211028184149815" style="zoom:67%;" />

 <br/> <br/>

##### ① 非归零编码【NRZ】

 <br/>

高 1 低 0

编码容易实现，但没有检错功能，且无法判断一个码元的开始和结束，以至于收发双方难以保持同步。

 <br/> <br/>

##### ② 归零编码【RZ】

 <br/>

仍然是 高1低0，信号电平在一个码元内都要恢复到零的编码方式。 

 <br/> <br/>

##### ③ 反向不归零编码【NRZI】

 <br/>

信号电平翻转表示0，不翻转表示1

 <br/> <br/>

##### ④ 曼彻斯特编码

 <br/>

将一个码元分隔为两个相等的时间间隔，（先低后高）前一个间隔为低电平后一个间隔为高电平表示 1 ，（先高后低）前一个间隔为高电平后一个间隔为低电平表示 0。表示的1，0是可以反过来的.

此编码的特点是：

在每一个码元的中间都会发生跳变，位中间的跳变即作时钟信号（可用于同步），又作为数据信号。

但是，他所占的频带宽度是原始的基带宽度的两倍。每一个码元都被调为两个电平，所以数据传输速率只有调制速率的1/2.

 <br/> <br/>

#####  ⑤ 差分曼彻斯特编码

 <br/>

在每个码元的末尾，查看是否变化，改变为1，不变为0，中间也会跳转。

常用于局域网传输，其规则是：若码元为1，则前半个码元的电平相同，若为0，则相反。该编码的特点是：在每个码元的中间都有依次电平的跳转，可以实现自同步，且抗干扰性强于曼彻斯特（实现算法更为复杂）。

 <br/> <br/>

##### ⑥ 4B/5B编码

 <br/>

比特流中插入额外的比特以打破一连串的0或1，就是用5比特的内容表示4比特，之后再传给接收方，因此称为4B/5B。编码效率为80%。

只采用16种对应16种不同的4位码，其他的16种作为控制码（帧的开始，结束，线路状态信息等）或保留。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet18.png" alt="image-20211028191127068" style="zoom: 67%;" />

<br/><br/><br/><br/>

#### （3）数字数据调制为模拟信号

<br/>

数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应于调制解调器的调制与解调过程。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet19.png" alt="image-20211028191802380" style="zoom: 67%;" />

<br/>

在计算时，把三种类型的数目乘起来就是总的电平种类。

<br/><br/><br/><br/>

#### （4）模拟数据编码为数字信号

<br/>

计算机内部处理的都是二进制数据，处理的都是数字音频，所以需要将模拟音频通过采样，量化转化为有限个数字表示的离散序列（即实现音频数字化）

最典型的例子就是对音频信号进行编码调制（PCM），在计算机应用中，所能达到的最高水平的就是PCM编码，被广泛应用于素材保存和音乐欣赏，CD，DVD以及我们常见的WAV文件均有应用。它主要包含三步：抽样，量化，编码。

<br/>

抽样：对模拟信号进行扫描，把时间上连续的信号变成时间上的离散信号。

为了使所得的离散信号能无失真地代表被抽样的模拟数据，要使用采样定理进行处理：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunetpng" style="zoom:67%;" />

<br/>

量化：把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值，并取整数，这样就能把连续的电平幅值转化为离散的数字量。

编码：把量化的结果转化为与之对应的二进制编码。

<br/><br/><br/><br/>

#### （5）模拟数据调值为模拟信号

<br/>

为了实现传输的有效性，可能需要较高的频率（较高的频率传输数据会更好更远）。这种调制方式还可以使用频分复用技术，充分利用宽带资源。在电话机和本地本地交换机所传输的信号是采用模拟信号传输模拟数据的方式：模拟的声音数据是加载到模拟的载波信号中传输的。

<br/><br/><br/><br/><br/><br/>

### 5.物理层传输介质

<br/>

#### （1）传输介质和分类

<br/>

传输介质也称为传输媒体/传输媒介，他就是数据传输系统中在发送设备和接收设备之间的物理通路。

注：

传输媒体并不是物理层。

传输媒体在物理层的下面，因为物理层是传输媒体结构的第一层，因此有时称为传输媒体为0层。在传输媒体上传输的是信号，但是传输媒体只管传，不知道传的是什么。但是物理层知道传的是什么，因为物理层规定了电气特性。

<br/>

传输介质：

- 导向性传输介质：电磁波被导向沿着固定媒介（铜线/光纤）传播
- 非导向性传输介质：自由空间，介质可以是空间，真空，海水。

<br/><br/><br/><br/>

#### （2）双绞线

<br/>

双绞线是古老，又最常用的传输介质。它是由两根采用一定规则并排绞合的，相互绝缘的铜导线组成。

通过绞合，可以减少相邻导线的电磁干扰。

<br/>

双绞线有两种：无屏蔽双绞线和屏蔽双绞线。

为了进一步提高抗干扰能力，可在双绞线的外面再加上一个由金属丝编织成的屏蔽层，这是屏蔽双绞线(STP)，无屏蔽层的双绞线就称为非屏蔽双绞线（UTP）。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet20.png" alt="image-20211028215833673" style="zoom:80%;" />

<br/>

双绞线价格便宜，是最常用的传输介质之一，在局域网和传统电话网中普遍使用。模拟传输和数字传输都可以使用双绞线，其通信距离一般是几公里到数十公里。距离过远时，对于模拟传输要用放大器放大衰减的信号：对于数字传输，要用中继器将失真的信号整形。

<br/><br/><br/><br/>

#### （3）同轴电缆

<br/>

同轴电缆由导体铜质芯线，绝缘层，网状编制屏蔽层和塑料外套组成。按特性阻抗数值的不同，通常将同轴电缆分为两类：50欧同轴电缆和75欧同轴电缆。

50欧同轴电缆主要用于传输基带数字信号，又称为基带同轴电缆，他在局域网中得到广泛应用。

75欧同轴电缆主要用于传输宽带信号，又称为宽带同轴电缆，它主要用于有线电视系统。

<br/>

同轴电缆VS双绞线

由于外导体屏蔽层作用，同轴电缆的抗干扰性比双绞线好（包括屏蔽双绞线），被广泛用于出阿叔较高速率的数据，其距离传输更远，但价格比双绞线更贵。

<br/><br/><br/><br/>

#### （4）光纤

<br/>

##### ① 概念

<br/>

光纤通信就是利用光导纤维传递 **光脉冲** 来进行通信。

有光脉冲表示1，无光脉冲表示0.

可见光的频率大约是10^8MHz，因此，光纤通信系统的宽带远远大于目前其他各种传输媒体的带宽。

<br/>

光纤主要是由纤芯（实心的）和包层构成，光波通过纤芯进行传导，包层较纤芯有较低的折射率。当光线从高折射率的介质射向低折射率的介质时，其折射角将大于入射角。因此，如果入射角足够大，就会出现 全反射，即光线配到包层时候就会折射回纤芯，这个过程是不断重复的，光也就沿着光纤一直传输下去。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet21.png" alt="image-20211028223630753" style="zoom:80%;" />

<br/><br/>

##### ② 分类

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet22.png" alt="image-20211028223820528" style="zoom:80%;" />

<br/>

|          | 定义                               | 光源                   | 特点                   | 外观             |
| -------- | ---------------------------------- | ---------------------- | ---------------------- | ---------------- |
| 单模光纤 | 一种在横向模式直接传输光信号的光纤 | 定向性很好的激光二极管 | 衰耗小，适合远距离传输 | 中间的光纤非常细 |
| 多模光纤 | 有多种传输光信号模式的光纤         | 发光二极管             | 易失真，适合近距离传输 |                  |

<br/>

一根光缆少则一根光纤，多则包含十至数百光纤

<br/>

##### ③ 光线的特点：

- 传输损耗小，中继距离长，对远距离传输特别经济
- 抗雷电和电磁干扰信好
- 无串音干扰，保密性好，也不容易被窃听或截取数据
- 体积小，重量轻

<br/><br/><br/><br/> 

#### （5）非导向性传输介质

<br/>

##### ① 无线电波

<br/>

信号向所有方向传输

较强的穿透能力，可传远距离，广泛用于通信领域

<br/><br/>

##### ② 微波

<br/>

信号固定方向传输

微波通信频率较高，频段范围宽，因此数据率很高

- 地面微波通信：就是在地面建立传播的基站，对数据进行传输
- 卫星通信

<br/><br/>

##### ③ 红外线，激光

<br/>

信号固定方向传播

把要传输的信号分别转换为各自的信号格式，即红外光信号和激光信号，再在空间中传播。

<br/><br/><br/><br/><br/><br/>

### 6.物理层设备

<br/>

##### ① 中继器

<br/>

诞生原因：由于存在损耗，在线路上传输的信号功率会衰减，衰减到一定程度上就会引起失真，因此会导致接收错误

<br/>

中继器的功能：再生数字信号

对信号进行 **再生和还原**，对衰减的信号进行放大，保持与原数据相同，以增加传输距离，延长网路的长度。

<br/>

中继器的两端：

- 两端的网络部分是网段，而不是子网，适应于完全相同的两类网络的互连，且两个网段速率要相同。
- 中继器只将任何电缆段上的数据发送到另一电缆段上，它仅作用于信号的电器部分，并不管数据中是否有错误数据或不适于网段的数据
- 两端可连相同的媒体，也可以连接不同的媒体。
- 中继器两端的网段一定要是同一个协议

<br/>

5-4-3规则：网络标准中对信号的延迟范围做出了具体的规定，因而中举起只能在规定的范围内进行，否则会网络故障。

所谓“5-4-3规则”，是指在10M以太网中，网络总长度不得超过5个区段，4台网络延长设备，且5个区段中只有3个区段可接网络设备。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet23.png" alt="image-20211029002453231" style="zoom:67%;" />

<br/><br/>

##### ② 集线器（多口中继器）

<br/>

集线器功能：再生，放大信号

对信号进行再生放大转发，对衰减的信号进行放大，接着转发到其他所有（除输入端口外）处于工作状态的端口上，以增加信号传输的距离，延长网络的长度。

集线器的本质就是中继器，不能分割冲突区域，连在集线器上的工作主机平分带宽。

<br/>

集线器采用星状拓扑：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet24.png" alt="image-20211029003732702" style="zoom:50%;" />

<br/><br/><br/><br/><br/><br/><br/><br/>

## （三）数据链路层

<br/>

### 1.基本概念

<br/>

结点：主机，路由器

链路：网路中两个结点之间的物理通道，链路的传输介质主要有双绞线，光纤，微波。分为有线链路，无线链路。

数据链路：网络中两个结点之间的逻辑通道，把实现控制数据传输协议的硬件和软件加到链路上就构成了数据链路。

数据链路层负责通过一条链路从一条链路向另一个物理链路直接相连的相邻结点传送数据报。

<br/>

功能：

概述：数据链路层在物理层提供服务的基础上向网络层提供服务，其最基本的服务是将源自网络的层来的数据**可靠**的传输到相邻结点的目标网络层。

其主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。

- 为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。
- 链路管理，即连接的建立，维持，释放（用于面向连接二的服务）
- 组帧
- 流量控制。
- 差错控制（帧错/位错）

<br/><br/><br/><br/><br/><br/>

### 2.封装成帧和透明传输

<br/>

#### （1）封装成帧

<br/>

封装成帧：就是在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。

接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从接收的比特流中识别出的帧的开始和结束

帧同步：接收方应当能从接收到的二进制的比特流中区分出帧的开始和结束。

组帧的四种方法：1.字符计数法；2.字符填充法；3.零比特填充法；4.违规编码法

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet25.png" alt="image-20211029130502316" style="zoom:67%;" />

<br/><br/><br/><br/><br/><br/>

#### （2）透明传输

<br/>

定义：是指不管传输的数据是什么样的比特组合，都应当能在链路上传送。

当所传数据中的比特组合恰巧与某一控制信息完全一样时，就必须采用适当的措施，是接收方不会将这样的信息认为是某种控制信息。这样才能保证数据链路层的传输是透明的。

<br/><br/><br/><br/>

#### （3）组帧方法

<br/>

##### ① 字符计数法

<br/>

帧首部使用的一个计数字段（第一个字节，8位）来表明帧内字符数。

出现的问题：在有一个计数出错时，可能会造成非常严重的错误。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet26.png" alt="image-20211029131631356" style="zoom:67%;" />

<br/><br/>

##### ② 字符填充法

<br/>

定义：采用两个一字节标识符SOH和EOT表示帧的开始和结束

注：

- 当数据部分存在SOH，EOT或ESC时，需要在他们的前面在加一个ESC转义符，防止识别出错。
- 当传送的帧是由文本文件组成时（文本文件的字符都是从键盘上输入的，都是ASCII码）。不管从键盘上输入什么字符可以放到帧里面传过去，即透明传输。
- 当传送的帧是由非ASCII码的文本文件组成时（二进制代码的程序或图像等）。就要采用字符填充方法实现透明传输。

<br/>

![image-20211029132802450](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet27.png)

<br/><br/>

##### ③ 零比特填充法

<br/>

零比特填充发的 标识符（01111110）在帧的两边作为开始和结束，为了防止出现连续的6个1，就要在每5个1的后面填充一个0。

具体操作：

在发送端，扫描这个信息字段，只要连续5个1，就在后面加一个0



在接收段收到一个帧时，先找到标志字段确定边界，再用硬件斤西瓜扫描，发现连续5个1时，就把后面的0去掉。

<br/>

这个地方就要把中间数据部分的5个1后面加1个0：

<br/>

![image-20211029134012006](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet28.png)

<br/><br/>

##### ④ 违规编码法

<br/>

曼彻斯特编码中，用高-高，低-低来定界帧的起始和终止

<br/><br/>

由于字节计数法和Count字段的脆弱性（其值若有错误会导致灾难性后果）即字符填充实现上的复杂性和不兼容性，目前普遍使用的帧同步法时比特填充法和违规编码法。

<br/><br/><br/><br/><br/><br/>

### 3.差错控制

<br/>

####  （1）差错的由来

<br/>

概括来说，传输中的查错都是由于噪声引起的

全局性：由于线路本身的电气特性所产生的随机噪声（热噪声），是信道固有的，随即存在的

​               解决办法：提高信噪比来减少或避免干扰（对传感器下手）

局部性：外部特定的短暂原因所造成的冲突噪声，是产生差错的主要原因

​               解决办法：通常用编码技术来解决

<br/>

差错的种类：

- 位错：数据中1变为0，0变为1
- 帧错：帧丢失，帧重复，帧失序

<br/>

链路层为网路层提供服务：无确认无连接服务（通信质量好，有线传输链路），有确认无连接服务和有确认面向连接服务（通信质量差的无线传输链路）

<br/><br/><br/><br/>

#### （2）差错控制（比特错）

<br/>

检验编码：奇偶校验码，循环冗余码CRC

纠错编码：海明码

<br/>

数据链路层的编码与物理层的编码：

数据链路层编码和物理层的编码与调制不同。物理层编码针对的是单个比特，解决传输过程中比特的同步等问题，如曼彻斯特编码。而数据链路层的编码针对的是一组比特，他通过冗余码的技术实现一组二进制比特串在传输过程中是否出现了查错。

<br/>

冗余编码：在数据发送之前，先按某种关系附加上一定的冗余位，构成一个符合某一种规则的码字后再发送。当要发送的有效数据变化时，相应的冗余码也会发生变化。使码字遵从不变的原则。接收端根据收到的码字是否符合原规则，从而判断是否出错。

<br/><br/>

##### ① 奇偶校验码

<br/>

在数据的头部或尾部放置一个 1或0 ，使数据中的1满足奇数个或偶数个，到接收方时查看数据是否符合先前制定的规则（1的个数是奇数个或偶数个）。

检错能力为50%。

<br/><br/>

##### ② CRC循环冗余码

<br/>

循环冗余码的计算步骤：

- 发送方将数据加0，假设生成的多项式G(x)的阶为r，则加r个0
- 模2除以多项式的系数列，得到余数
- 加余数
- 接受方用接收的数据，模2除系数列，若余数是0，则数据正确，反之错误

<br/>

举例：

<br/>

要发送的数据为1101011011，采用CRC生成的多项式为P(X)=X^4 + X + 1，试求真正发送的数据和接收方接收此数据的检验。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet30.png" alt="image-20211030104339272" style="zoom:80%;" />

 <br/> <br/>

##### ③ 海明码

 <br/>

计算步骤：

- 确定校验码的位数r，2^r >= k+r+1，r为冗余信息位，k为信息位
- 确定校验码的位置，校验码从左到右依次放在 2^n 处
- 确定校验码的值，例如：第一个校验码是将二进制数第一位为1的所有数进行异或，第二个校验码是将二进制数第二位为1的所有数进行异或
- 接收方用同样的方式将数据连带校验位依次异或，从最后一个异或结果作为最高位依次排列，的到出错的位数

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet31.png" alt="image-20211030111339132" style="zoom:80%;" />

<br/><br/><br/><br/><br/><br/>

### 4.流量控制和可控传输机制

<br/>

####  （1）流量控制

<br/>

可靠传输：发送端发什么，接收端就接收什么

流量控制：控制发送速率，是接收方有足够的缓冲空间来接收每一帧

<br/>

流量控制的原因：较高的发送速度与较低的接受能力不匹配，会造成传输出错。

<br/>

数据链路层与传输层的流量控制：

数据链路层的流量控制是点对点的，而传输层的流量控制是端到端的

数据链路层的流量控制手段：接受方收不下就不回复确认

传输层的流量控制手段：接收端给发送端一个窗口公告

<br/>

流量控制的方法：

- 停止-等待协议：每发送一个帧就停止发送，等待接收方确认，在接收到确认后再发送下一个帧。
- 滑动窗口协议：后退N帧协议（GBN），选择重传协议（SR）

停止-等待协议：发送窗口大小=1，接收窗口大小=1

后退N帧协议：发送窗口大小>1，接收窗口大小=1

选择重传协议：发送窗口大小>1，接收窗口大小>1

<br/>

滑动窗口解决了流量控制和可靠传输

<br/><br/><br/><br/>

#### （2）停止-等待协议

<br/>

原因：

出现比特出错外，底层信道还会出现丢包问题。为了实现流量控制

丢包：物理线路故障，设备故障，病毒攻击，路由信息错误等原因，会使数据包丢失。

<br/>

前提：

虽然现在常用全双工通信方式，但为了讨论问题的方便，仅考虑一方发送数据（发送方），一方接收数据（接受方）。

因为在讨论可靠传输的原理，所以并不考虑数据是在哪一层传送的

“停止-等待”就是每发送完一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组

<br/>

性能分析：简单但信道利用率太低

信道利用率：

发送方在一个发送周期内，有效地发送数据所需要的时间站整个发送周期的比率

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet36.png" alt="image-20211030161218824" style="zoom:67%;" />

<br/>

其中，TD为L（发送数据大小）/   C（发送方数据传输率）

<br/>

弊端：

在传输过程中，每一次都需要等发送确认后才能传下一个，导致信道利用率太低。

虽然可以采用流水线技术，但利用率仍然较低。

<br/>

几种应用场景：

<br/>

##### ① 无差错情况

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet32.png" alt="image-20211030155924544" style="zoom:50%;" />

<br/>

每发送完一个帧后就停止，等待确认消息，确认后再发送另一个帧。

<br/><br/>

##### ② 数据帧丢失或检测到帧出错

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet33.png" alt="image-20211030160223761" style="zoom:50%;" />

<br/>

在发送后一段时间内没有收到确认消息，就会重新发送一次，若一段时间后还没收到就会在发，直到收到确认消息才会继续发送下一帧。

<br/>

超时计时器：每次发送一个帧就启动一个计时器。

注：超时计时器的设置的重传时间应当比帧传输的平均RTT更长一些。

发送完一个帧后必须保留他的副本

数据帧和确认帧必须编号

<br/><br/>

##### ③ ACK丢失

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet34.png" alt="image-20211030160753905" style="zoom:50%;" />

<br/><br/>

##### ④ ACK迟到

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet35.png" alt="image-20211030160938893" style="zoom:50%;" />

<br/><br/><br/><br/>

#### （3）后退N帧协议

<br/>

##### ① 滑动窗口

<br/>

发送窗口：发送方维持一组连续的允许发送帧的序号。

接收窗口：接受方维持一组连续的允许接收帧的序号。

<br/>

在同一窗口下数据是可以连续发送的，这就一定程度的解决了信道利用率低的问题。

当收到窗口第一个数据的确认后窗口可以向后移动，就能使数据保持连续发送

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet37.png" alt="image-20211030164233044" style="zoom:50%;" />

<br/><br/><br/><br/>

##### ② 发送方需要响应的事

<br/>

1）上层的调用

上层要发送数据时，发送方先检查窗口是否已满，如果未满，则产生一个帧并将其发送；如果窗口已满，发送方只需将数据返回给上层，暗示上层窗口已满。撒谎上层等一会再发送。（实际情况中，发送方可以缓存这些数据，等窗口不满时再发送帧）

2）收到一个ACK

GBN协议中，对n号帧的确认采用 **累计确认** 的方式，**标明接收方已经收到n号帧和它之前的全部帧**

3）超时事件

协议的名字为后退N帧，来源于出现丢失和时延过长时发送方的行为。就像在停等协议中一样，定时器将再次用于恢复数据帧或确认帧的丢失。如果出现超时，发送方重传所有已发送但未被确认的帧。

<br/>

如果正确的收到n号帧，并且按序，那么接收方为n帧发送一个ACK，并将该帧中的数据部分交给上层。

其余情况都丢失帧，并为最近按序接收的帧重新发送ACK，接收方无需缓存任何丢失帧，只需要维护一个信息：expectedseqnum（下一个按序接收的帧序号）

<br/><br/>

##### ③ 差错情况

<br/>

ACK的发送不一定是连续的，因为ACK的传输可能出现错误，有可能出现发送端没有接收ACK2但接收到ACK3的情况，

只要接收端发出了ACK2，就可以接收后面的帧；

发送端只要接收到了ACK3或后面的ACK就默认前面的帧已经被接收到了，不会出现超时。

<br/>



<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet38.png" alt="image-20211030165755679" style="zoom:50%;" />

<br/>

当2帧发送失败后，由于没有ACK2，导致后面的帧获得后都直接丢弃并再次发送ACK1，当2帧确认超时会重传2帧，在接收2帧后发送ACK2，后面的帧才能被接收。

<br/><br/>

##### ④ 窗口的长度

<br/>

若采用n比特对帧进行编号，那么发送窗口尺寸WT应满足：

<br/>

![image-20211030170746098](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet39.png)

<br/>

因为窗口过大，会使接收方无法分别新帧和旧帧。

<br/><br/>

##### ⑤ 弊端

<br/>

当前面一个帧没被接收到时，后面的帧全部丢弃，会造成传输速率的降低。

<br/><br/><br/><br/>

#### （4）选择重传协议

<br/>

##### ① 窗口

<br/>

发送方和接收方的窗口都是多个，获取到哪个的ACK，哪个就确认，不用管前面的和后面的。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet40.png" alt="image-20211030171441663" style="zoom:50%;" />

<br/><br/>

##### ② 发送方需要响应的事

<br/>

1）上层的调用

从上层收到数据后，SR发送方检查下一个可用于该帧的序号，如果序号位于发送窗口内，则发送数据帧；否则就像GBN一样，要么将数据缓存，要么返回给上层后再传输。

2）接收到一个ACK

如果接收到ACK，加入该帧序号在窗口内，则SR发送方将那个被确认的帧标记为已接收。如果该帧序号是窗口的下界（最左边第一个窗口对应的序号），则窗口向前移动到最小序号的未确认帧处。如果收到了窗口外的帧（小于窗口的下界），就直接返回一个它的ACK。如果窗口移动并且有序号在窗口内未发送帧，则发送这些帧。

3）超时事件

每个帧都有自己的定时器，一个超时事件只传一个帧。

<br/><br/>

##### ③ 差错情况

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet41.png" alt="image-20211030173040289" style="zoom:50%;" />

<br/><br/>

##### ④ 窗口长度

<br/>

发送窗口最好等于接收窗口（大了会溢出，小了没意义）

n为帧序号最大数

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet42.png" alt="image-20211030173434591" style="zoom:67%;" />

<br/>

当窗口过长时，会出现此错误，同样都是接收0号，但不知道接收的是新传的0，还是原先的0。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/comounet43.png" alt="image-20211030173747442" style="zoom: 50%;" />

<br/><br/><br/><br/><br/><br/>

### 5.信道划分介质访问控制

<br/>

#### （1）传输数据的两种链路

<br/>

点对点式链路：两个相邻节点通过一个链路相连，没有第三者。

​                         应用：PPP协议，常用于广域网

<br/>

广播式链路：所有主机共享通信介质

​                     应用：早期的总线以太网，无线局域网，常用于局域网

​                    典型拓扑结构：总线型，星型（逻辑总线型）

<br/><br/><br/><br/>

#### （2）信道划分介质访问控制

<br/>

##### ① 介质访问控制MAC

<br/>

介质访问控制的内容是：采取一定的措施，使得两对节点之间的通信不会发生干扰的情况

<br/>

信道划分MAC协议：

- 基于多路复用划分资源。
- 网络负载重：共享信道效率高，且公平
- 网络负载低：共享信道利用率低

随机访问MAC协议：

- 用户根据意愿随机发送信息，发送信息可以独占信道带宽
- 网络负载重：产生冲突开销
- 网络负载轻：共享信道效率高，单个节点可以利用信道的全部带宽

轮询访问MAC协议/轮流协议/轮转MAC协议：

- 既要不产生冲突，又要使用全部带宽

<br/>

介质访问控制示意图：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet44.png" alt="image-20211030213542392" style="zoom:50%;" />

<br/>

CS玩的时候要动起来，所以有CS的是动态分配信道

<br/><br/>

##### ② 信道划分介质访问控制

<br/>

定义：将使用介质的每个设备与来自同一信道上的其他设备之间的通信分隔开，把**时域和频域资源**合理的分给网络上的设备

多路复用技术：把多个信号组合在一条物理通信上进行传输，使得多个计算机或终端设备共享信道资源，提高信道利用率。

把一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，实际就是把广播信道转化为点对点信道。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet45.png" alt="image-20211030214543835" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （3）静态划分信道

<br/>

##### ① 频分多路复用FDM

<br/>

用户在分配到一定的频带后，在通信过程中自始自终都占用这个频带。频分复用的所有用户在相同的时间占用不同的宽带（频率宽带）资源。

充分利用传输介质宽带，系统的效率高；由于技术比较成熟，实现也比较容易。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet46.png" alt="image-20211030215117588" style="zoom: 50%;" />

<br/><br/>

##### ② 时分多路复用TDM

<br/>

将时间划分为一段段等长的时分复用帧（TDM）。每一个时分复用的用户在每一个TDM帧中占用固定序号的**时隙**，用户轮流使用信道。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet47.png" alt="image-20211030215514804" style="zoom:50%;" />

<br/><br/>

##### ③ 统计时分复用STDM

<br/>

每一个STDM帧中的时隙小于连接在集中器上的用户数。

各用户有了数据就随时发往集中器的输入缓存。

然后集中器按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中，一个STDM帧满了就发出。

注：

- STDM帧不是固定分配时隙，而是按需动态分配时隙
- 下图中右边大括号括的就是STDM帧
- 每个时隙内的前面都有一个白条用于说明地址

<br/>

统计时分复用相对于时分复用多了一个集中器，负责对发来的数据进行集中处理，这样做使得当某个数据发送频率较高时，有更多的时间利用信道，当某个数据发送频率较低时，将信道空余的时间给其他主机用，实现类动态分配，提高了数据的传输速率。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet48.png" alt="image-20211030220615398" style="zoom: 50%;" />

<br/><br/>

##### ④ 波分多路复用WDM

<br/>

波分多路复用就是光的频分多路复用

在一根光纤中传输多种不同波长（频率）的光信号，由于波长（频率）不同，所以各路光信号互不干扰，最后用波长分解复用器将各路波长分解出来。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet49.png" alt="image-20211030221121946" style="zoom: 67%;" />

<br/><br/>

##### ⑤ 码分多路复用CDM

<br/>

码分多址（CDMA）：码分复用的一种方式

1个比特分为多个码片/芯片，每一个站点被指定一个唯一的m位芯片序列（0变-1）。

发送1时战点发送芯片序列，发送0时发送芯片序列的反码（1变为-1，-1变为1）

<br/>

存在多个芯片一起发送时，如何不会相互影响：要求个站点芯片序列相互正交

将各站点数据合并：各数据同位相加

如何分离：合并的数据与源站（自己的芯片序列）规格化内积

结果：1，传的：1

结果：-1，传的：0

结果：0，传的：没传

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet50.png" alt="image-20211030223453933" style="zoom:80%;" />

<br/><br/><br/><br/> 

#### （4）动态分配信道

<br/>

动态媒体接入控制/多点接入

特点：信道并非在用户通信时固定分配给用户

随机访问介质访问控制：所有用户可以随机发送信息，发送信息时占用全部宽带。

<br/><br/>

##### ① ALOHA协议

<br/>

ALOHA协议分为：纯ALOHA协议和时隙ALOHA协议

<br/>

1）纯ALOHA协议

纯ALOHA协议思想：不监听信道，不按时间槽发送，随即重发。

冲突检测：如果发生冲突，接收方在就会检测出错，然后不许确认，发送方在一定时间收不到就会判断发生冲突

解决冲突：超时后等一随机事件重发

T0：包括发送时间和传播时间

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet51.png" alt="image-20211031104537540" style="zoom:67%;" />

<br/><br/>

2）时隙ALOHA协议

时隙ALOHA协议的思想：把时间分成若干个相同的 **时间片**，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻在发送。

如果发生冲突，接收方会在一个T0之后发现冲突，再在下一个时间片开始时刻再发。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet52.png" alt="image-20211031105702671" style="zoom:67%;" />

<br/>

两种ALOHA协议的区别：

- 纯ALOHA协议比时隙ALOHA协议吞吐量更低，效率更低
- 纯ALOHA协议想发就发，时隙ALOHA只有在时间片开始时刻才能发

<br/><br/>

##### ② CMSA协议

<br/>

###### 1）概念

<br/>

 CSMA：载波监听多路访问协议

CS：载波监听/侦听，每一个站发送数据之前要检测一下总线上是否有其他计算机在发送数据

MA：多点接入，表示许多计算机以多点接入的方式连接在一条总线上。

<br/>

CS的原理：当几个站同时在总线上发送数据时，总线上的信号电压摆动值会增大（互相叠加），当一个站检测到信号电压摆动值超过一定限值时，就认为总线上至少有两个站在同时发送数据，表明产生了碰撞。

<br/>

协议思想：发送帧之前，监听信道

<br/>

监听结果：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet53.png" alt="image-20211031135337572" style="zoom: 67%;" />

<br/><br/>

###### 2）1-坚持CMSA

<br/>

坚持指的是对于监听信道忙之后的坚持

<br/>

1-坚持CMSA思想：

如果一个主机要发送信息，那么他就要先监听信道。

忙则一直监听，直到空闲马上传输。

如果有冲突（一段时间内未收到肯定回复），则等待一个随即时常再监听，根据结果重复此过程。

<br/>

优点：只要媒体空闲，站点就马上发送，避免了媒体利用率的损失。

缺点：假如有两个或两个以上的站点有数据要发送，冲突就不可避免。

<br/><br/>

###### 3）非坚持CSMA

<br/>

非坚持指的是对于监听信道忙之后就不继续监听。

<br/>

非坚持CSMA思想：

如果一个主机要发送信息，那么它先监听信道。

空闲就直接传输，不必等待。

忙则等待一个随机的时间之后再监听，重复此过程。

<br/>

优点：采用随机重发延迟时间可以减少冲突发生的可能性

缺点：可能存在大家都在延迟等待的过程中，使得媒体可能处在空闲状态，媒体使用率降低。

<br/><br/>

###### 4）p-坚持CMSA

<br/>

p-坚持是指对监听信道空闲的处理

<br/>

p-坚持CMSA思想：

如果一个主机要发送信息，那么它先监听信道

空闲则以 p 概率直接传输，不必等待；以1-p概率等待到下一个时间槽再传输

忙则坚持监听，等到空闲时重复上一步（注：以1-p概率不发送之后，等待一段时间，还是要继续判断是发送还是不发送）

<br/>

优点：既能像非坚持算法那样减少冲突，又能向1-坚持算法那样减少媒体空闲时间的这种方案。

缺点：发送冲突后还是要坚持把数据发送王，造成了浪费。

<br/><br/>

##### ③ 轮询协议

<br/>

主结点循环询问从属结点是否要发送信息，如果要，就此段时间只有此结点能够发送数据，如果不要，就继续询问下一个结点。

如果主结点出现问题，在实际情况中存在备用主结点。

问题：轮询开销，等待延迟，单点故障

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet54.png" alt="image-20211031142628111" style="zoom:67%;" />

<br/><br/>

##### ④ 令牌传递协议

<br/>

令牌：一种特殊格式的MAC控制帧，在令牌控制帧后加上数据，然后让令牌循环找到指定接收方将数据传递。

<br/>

令牌的使用：

令牌中存在一个标志位用来标识令牌是否处于空闲状态，当有结点要发送数据时，就把空闲状态转化为忙的状态。

当令牌处于空闲的状态时，就会一直在个阶段之间循环移动。

每个结点都可以在一定的时间内（令牌持有时间）获得发送数据的权力，并不是无限制的持有令牌。

<br/>

使用场景：

应用于令牌环网（物理星型拓扑，逻辑环形拓扑）

采用令牌传送方式的网络常用于负载过重，通信量大的网路中

<br/>

问题：

令牌开销，等待延迟，单点故障

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet55.png" alt="image-20211031143818948" style="zoom:67%;" />

<br/><br/>

##### ⑤ CSMA/CA协议

<br/>

含义：载波监听多点接入/碰撞避免CSMA/CA

<br/>

CSMA/CA出现的原因：

- 无法做到360度，全面检测碰撞
- 隐蔽站：当A和C都检测不到信号时，认为信道空闲，同时向终端发送B发送数据，就会导致冲突

<br/>

工作原理：

- 发送数据前先检测信道是否空闲
- 空闲则发出RTS(request to send)，RTS包括发送端的地址，接收端的地址，下一份数据将持续发送时间等信息；信道忙则等待
- 接收端收到RTS后就会响应CTS(clear to send)
- 发送端收到CTS后，开始发送数据帧（同时预约信道：发送方告知其他站点自己要传多久数据）
- 接收端收到数据帧后就要利用CRC来检验数据是否正确，正确则响应ACK帧
- 发送方接收到ACK后就可以进行下一个数据帧的发送，若没有则一直重传至规定次数为止（采用二进制指数退避算法来确定随机的推迟时间）

<br/><br/>

##### ⑥ CSMA/CD

<br/>

含义：载波监听多点接入/碰撞检测协议

<br/>

CS：载波监听，每一个站在发送数据前和发送数据时都要检测一下总线上是否有其他计算机在发送数据。

MA：多点接入，表示许多计算机以多点接入的方式接入同一个网络。总线型网络

CD：碰撞检测，“边发边监听”，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时是否有其他站也在发送数据

<br/>

此协议的目的：数据的发送是会维持一定时间，系统在发现碰撞后就立刻停止发送，这样可以在很大程度上提高信道利用率

注：

在碰撞后不会是立刻就能知道要等到碰撞的信号传到时才能发送

下图中的字迹就是有关碰撞的计算

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet62.png" alt="image-20211107220602159" style="zoom:67%;" />

<br/>

**截断二进制指数规避算法**

<br/>

- 确定基本退避（推迟）时间为争用期2t
- 定义参数k，它等于重传次数，但k不过10，即k={重传次数，10}。当重传次数不超过10时，k等于重传次数；当重传次数超过10次时，k=10
- 从离散的整数集合【0,1,,2^k-1】中随机去一个数r，重传所需退避的时间就是r倍的基本退避时间，即2rt
- 当重传到达16次仍不能成功，说明网络太过拥挤，认为此帧无法正确发出，抛弃此帧并向高层报告出错

<br/>

**最短帧长**

<br/>

帧的传输时延至少要两倍于信号在总线中的传播时延

最小帧长 = 总线传播时延 x 数据传输速率 x 2

2t x 数据传输速率

以太网规定的最短帧长为64B，凡长度小于64B的都是由于冲突而异常终止的无效帧

<br/><br/>

##### ⑦ CSMA/CD与CSMA/CA

<br/>

相同点：

CSMA/CD与CSMA/CA机制都属于CSMA线路，其核心就是先听再说（就是先监听，再看是否发送）。

<br/>

不同点：

- 传输介质不同：CSDM/CD用于总线式以太网【有线】，而CSMA/CA用于无线局域网【无线】
- 载波检测方式不同：CSMA/CD通过电缆中打压的变化来检测，当数据碰撞时，电缆中的电压就会发送变化；而CSMA/CA采用能量检测（ED），载波检测（CS），能量载波会混合检测三种检测信道空闲的方式。
- CSMA/CD检测冲突，CSMA/CA避免检测，二者出现冲突后都会进行有上线的重传

<br/><br/><br/><br/><br/><br/>

### 6.局域网基本概念和体系结构

<br/>

#### （1）基本概念

<br/>

局域网：简称LAN，是指在 **某一区域** 内由多台计算机互联而成的计算机组，使用 **广播信道**。

<br/>

特点：

- 覆盖的地理范围小，只在一个相对独立的局部范围内联，如一座或集中的建筑群内
- 使用专门铺设的介质（双绞线，同轴电缆）进行联网，数据传输速率高（10Mb/s~10Gb/s）
- 通信延迟时间短，误码率低，可靠性较高
- 各站为平等关系，共享传输信道
- 多采用分布式控制和广播式同i性能，能进行广播和组播

决定局域网的主要要素为：网络拓扑，传输介质与介质访问控制方法

<br/><br/>

局域网拓扑结构：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet56.png" alt="image-20211104112545828" style="zoom: 67%;" />



<br/><br/><br/><br/>

物理拓扑：在实际情况中，线和设备的连接方式

逻辑拓扑：在构造好物理拓扑上，想像数据在各种设备和信道的传输顺序

逻辑拓扑可以与物理拓扑不同

<br/><br/><br/>

介质访问控制方法：

- CSMA/CD：常用于总线型局域网，也用于树形网络

- 令牌总线：通常用于总线型局域网，也用于树型网络

  ​                  他是把总线型或树型网络中的各个工作站按一定的顺序如按接口地址大小排列形成一个逻辑环。只有令牌的持有者才能够控制总线，才有发送信息              的权力

- 令牌网：用于环形局域网，如令牌环网

<br/><br/>

局域网的分类：

- 以太网：以太网是应用最广泛的的局域网，包括以太网（10Mbps），快速以太网（100Mbps），千兆以太网（1000Mbps）和10G以太网，他们都符合IEEE802.3系列标准规范。**逻辑拓扑总线型，物理拓扑是星型或拓展星型**。使用CSMA/CD
- 令牌环网：**物理上采用了星形拓扑结构，逻辑上使用了环形拓扑结构**
- FDDI网：物理上采用双环拓扑结构，逻辑上采用了双环拓扑结构
- ATM网：较新型的单元交换技术，使用53字节固定长度的单元进行交换
- 无线局域网WLAN：采用IEEE802.11标准

<br/><br/>

IEEE802标准：

IEEE802系列标准是IEEE802 LAN/MAN标准委员会制定的局域网，城域网技术标准（1980年2月成立）。其中最广泛使用的有以太网，令牌网，无线局域网等。这一系类标准中每一个子标准都由委员会中一个专门工作组负责。

需要记住的有四种：

IEEE802.3：以太网介质访问控制协议（CSMA/CD）及物理层技术规范

IEEE802.5：令牌环网的介质访问控制协议及物理层技术规范

IEEE802.8：光纤技术咨询组，提供有关光线联网的技术咨询

IEEE802.11：无线局域网（WLAN）的介质访问控制协议及物理层技术规范

<br/><br/>

MAC子层和LLC子层：

IEEE802标准所描述的局域网参考模型只对应OSI参考模型的数据链路层与物理层，它将数据链路层划分为逻辑链路控制子层（LLC子层）和介质访问控制子层（MAC子层）

LLC：负责识别网络层层协议，然后对它们进行封装。LLC报头告诉数据链路层一旦帧被接收时，应当对数据包做何处理。为网路层提供服务：无确认无连接，面向连接，待确认无连接，高速传送。

MAC：数据帧的封装/卸装，帧的寻址和识别，帧的接收和发送，链路的管理，帧的差错控制等。MAC子层的存在屏蔽了不同物理链路种类的差异。

<br/><br/><br/><br/>

#### （2）以太网

<br/>

##### ① 基本概念

<br/>

定义：以太网是一种基带总线局域网规范，是当今现有局域网采用的最通用的通信协议标准。以太网使用CSMA/CD技术。

<br/>

以太网在局域网中占统治地位的原因：

- 造价低廉（以太网卡不到100块钱）
- 是应用最广泛的局域网技术
- 比令牌环网，ATM网便宜
- 满足网络速率的要求：10Mb/s~10Gb/s

<br/>

以太网的两个标准：

- DIX Ethernet V2：第一个局域网产品（以太网）规约
- IEEE 802.3：IEEE802委员会802.3工作组制定的第一个IEEE的以太网标准

<br/>

以太网提供无连接，不可靠的服务

无连接：发送方和接收方不存在“握手过程”

不可靠：部队发送方的数据帧编号，接收方不向发送方进行确认，差错帧直接丢失

以太网只实现无差错接收，不实现可靠传输

<br/>

以太网传输介质与拓扑结构的发展

传输介质：粗同轴电缆->细同轴电缆->双绞线+集线器

物理拓扑：总线型—>星型

使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD协议

以太网拓扑：逻辑上总线型，物理上星型

<br/><br/>

##### ② 10BASE-T以太网

<br/>

定义：10BASE-T是传输信号双绞线以太网，T表示双绞线，现10BASE-T采用的是无屏蔽双绞线（UTP），传输速率是10Mb/s

物理上采用星型拓扑，逻辑上采用总线型。

每段双绞线最长为100米，采用曼彻斯特编码

采用CSMA/CD介质访问控制

<br/><br/>

##### ③ 适配器与MAC地址

<br/>

计算机与外界有局域网的连接是通过适配器的

以前是用网络接口板和网络接口卡NIC，现在不再使用单独网卡。适配器上装有处理器和存储器（包括RAM和ROM），其中ROM上有计算机硬件地址MAC地址

在局域网中，硬件地址又称为物理地址，或者MAC地址

MAC地址：每个适配器有一个全球唯一的48位二进制地址，前24位代表厂家（由IEEE规定），后面24位厂家自己指定。常有6个十六进制的数表示，如02-60-8c-e4-b1-21

<br/><br/>

##### ④ 以太网MAC帧

<br/>

最常用的MAC帧是以太网V2的格式

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet57.png" alt="image-20211107212355582" style="zoom:67%;" />

<br/><br/>

##### ⑤ 高速以太网

<br/>

速率>=100Mb/s的以太网称为高速以太网

<br/>

**100BASE-T以太网**

在双绞线上传输100Mb/s基带信号的星型拓扑以太网，仍使用IEEE802.3的CSMA/CD协议

支持全双工和半双工，可以全双工方式下工作而无冲突

<br/>

**吉比特以太网**

在光纤或双绞线上传输1Gb/s信号

支持全双工和半双工，可在全双工方式下工作而无冲突

<br/>

**10吉比特以太网**

10吉比特以太网在光纤上传送10Gb/s信号

只支持全双工，无争用问题

<br/><br/><br/><br/>

#### （3）IEEE802.11

<br/>

定义：IEEE802.11是无线局域网通用的标准，它是由IEEE所定义的无线网络通信的标准

<br/>

##### ① MAC帧头格式

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet58.png" alt="image-20211107213649939" style="zoom:67%;" />

<br/>

比如：phone1向phone2发送信息，phone1需要通过baseStation1发向baseStation2再给phone2，

这时DA就是phone2的mac地址，SA就是phone1的mac地址

RA就是baseStation2的mac地址，TA就是baseStation1的mac地址

<br/>

注：下方这张图的，DA之类的含义就是上面那张图的中文意思，BSSID就是AP自己

<br/>

IEEE802.11的帧格式：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet59.png" alt="image-20211107214442390" style="zoom:67%;" />

<br/><br/>

##### ② 无线局域网的分类

<br/>

有固定基础设施无线局域网

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet60.png" alt="image-20211107215136972" style="zoom: 50%;" />

<br/>

无固定基础设施无线局域网的自组织网路

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet61.png" alt="image-20211107215525091" style="zoom: 50%;" />

<br/><br/><br/><br/>

### 7.PPP协议和HDLC协议

<br/>

#### （1）广域网

<br/>

广域网，通常跨度很大的物理范围，所覆盖的范围从几十公里到几千公里，它能连接多个国家和多个城市，或横跨几个洲并能提供远距离通信，形成国际型网络。

广域网的通信子网主要使用 **分组交换技术** ，广域网的通信子网可以利用公用分组交换网，卫星通信网和无线分组交换网，它将分布在不同地区的局域网或计算机系统连接起来，达到资源共享的目的。如：因特网是世界上范围最大的广域网。

<br/>

![image-20211108103451736](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet63.png)

<br/><br/><br/><br/>

#### （2）PPP协议

<br/>

特点：点对点协议PPP是目前世界上使用最广泛的数据链路层协议，用户使用拨号电话接入因特网时一般使用PPP协议

**只支持全双工网络**

<br/>

PPP协议应满足的要求：

- 简单：对于数据链路层的帧，无需纠错，无需序号，无需流量控制
- 封装成帧：帧定界符
- 透明传输：与帧定界符一样比特组合的数据应该如何处理：异步线路用字节填充，同步线路用比特填充
- 多层类型线路：串行/并行，同步/异步，电/光....
- 差错控制：错就丢弃
- 检测连接状态：链路是否正常工作
- 最大传输单元：数据部分最大长度MTU
- 网络层地址协商：知道通信双方的网络层地址

<br/>

无需满足的要求：

纠错，流量控制，序号，不支持多点线路

<br/>

PPP协议的三个组成部分：

1.一个将IP数据报封装到串行线路（同步串行/异步串行）的方法

2.链路控制协议LCP：建立并维护数据链路连接。身份验证

3.网络控制协议NCP：PPP可支持多种网络层协议，每个不同的网络层协议都要一个相应的NCP来配置，为网络层协议建立和配置逻辑连接

<br/>

PPP协议状态图

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet64.png" alt="image-20211108105813107" style="zoom:67%;" />

<br/>

PPP协议的帧格式

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet65.png" alt="image-20211108105929086" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （3）HDLC协议

<br/>

定义：高级数据链路控制，是一个在同步网上传输数据，面向比特的数据链路层协议，它是由国际标准化组织（ISO）根据IBM公司的SDLC协议扩展开发而成的。

数据报文可以进行透明传输，用于实现透明传输的“0比特插入法”易于硬件实现

只支持全双工通信

<br/>

**主站，从站，复合站**

主站：主要功能是发送命令（包括数据信息）帧，接收响应帧，并负责对整个链路的控制系统的初启，流程的控制，差错控制和恢复等（起控制作用的站）

从站：主要功能是接收由主站发来的命令帧，向主站发送响应帧，并配合主站参与差错恢复等链路控制（被控制的站）

复合站：主要功能是即能发送，又能接收命令帧和响应帧，并且负责整个链路的控制（既能当主站又能当从站的站）

<br/>

三种数据操作方式：

- 正常响应方式
- 异步平衡方式
- 异步响应方式

<br/>

帧格式：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet67.png" alt="image-20211108111725376" style="zoom:67%;" />

<br/>

 控制字段：

- 信息帧（I）的第1位为0，用于传输数据信息，或使用捎带技术对数据进行确认
- 监督帧（S）10，用于流量控制和差错控制，执行对信息帧的确认，请求重发或请求暂停发送等功能
- 无编号帧（U）11，用于提供对链路的建立，拆除等多种控制功能。

<br/><br/><br/><br/>

#### （4）链路层设备

<br/>

##### ① 物理层扩展以太网

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet68.png" alt="image-20211108113305932" style="zoom: 50%;" />

<br/><br/>

##### ② 链路层扩展以太网

<br/>

###### 1）概念

<br/>

网桥根据MAC地帧的目的地址对帧进行转发和过滤。当网桥接收到一个帧时，并不是向所有的出口发送此帧，而是先检查此帧的目的MAC地址，然后再确定将帧转发到哪一个接口，或者把他丢弃（即过滤）

网段：一般是只在一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器等）能够直接通讯的那一部分。

<br/>

优点：

- 过滤通信量，增大吞吐量
- 扩大物理范围
- 提高可靠性
- 可互联不同的物理层，不同的MAC子层和不同速率的以太网

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet70.png" alt="image-20211108114502450" style="zoom:67%;" />

<br/><br/>

###### 2）透明网桥

<br/>

定义：“透明”是指以太网上的站点并不知道多发送的帧将经过哪几个网桥，是一种即插即用设备—自学习

| 阶段     | 地址     | 接口     |
| -------- | -------- | -------- |
| 写入阶段 | 源地址   | 进入接口 |
| 转发阶段 | 目的地址 | 转发接口 |

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet71.png" alt="image-20211108115121104" style="zoom:67%;" />

<br/>

比如：

A发向B，首先，A发出信息，经过网桥，网桥查看转发表发现没有数据，就在转发表中记载A，左边接口，就会在右边接口传出，，继续向右发送，到第二个网桥，同样查看发现没有，就记载A，左边接口，继续从右接口发出，发现右边没有了就不管了。

之后，D向A发送数据，首先，D发送数据向两边网桥传输，在右边网桥发现没有D，就记载D，左边接口，发现有A，与D接口相同，就直接将接收到的数据丢弃 ，同时左边网桥发现没有D，就记载D，右边接口，有A是左边接口，就将数据发向左边接口。

<br/><br/>

###### 3）源路由网桥

<br/>

定义：在发送帧时，把最详细的最佳路由信息（路由最少/时间最短）放在帧的首部。

方法：源站以广播方式向欲通信的目的站发送一个发现帧。

记录所有可到达目的站的方案，将所有方案按路由数量，所需时间等进行排序，在下次有同样两个发送站和目的站时就直接按最好的发送。

<br/><br/>

###### 4）多接口网桥—以太网交换机

<br/>

在一个网桥中有多个接口，每个接口可以独占全部带宽

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunete69.png" alt="image-20211108122053013" style="zoom:67%;" />

<br/>

以太网交换机的两种交换方式：

直通式交换机：查完目的地址（6B）就立刻转发，延迟小，可靠性低，无法支持具有不同速率的端口的交换

存储转发式交换机：将帧放在高速缓存中，并检查是否正确，正确则转发，错误则丢弃。延迟大，可靠性高，可以支持具有不同速率的端口的交换。

<br/><br/>

##### ③ 冲突域与广播域

<br/>

冲突域：在同一个冲突域中的每一个节点都能接收到所有被转发的帧。简单来说就是同一时间只能有一台设备发送信息的范围。

广播域：网络中能接收到任意设备发出的广播帧的所有设备的集合。简单来说就是如果一个站点发出一个广播信号，所有能接收到这个信号的范围，

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet73.png" alt="image-20211108123004375" style="zoom:67%;" />

<br/><br/><br/><br/><br/><br/><br/><br/>

## （四）网络层

<br/>

### 1.概念

<br/>

主要任务式把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。

网络层传输单位式数据报

<br/>

功能：

- 路由选择与分组转发

- 异构网络互联（把不同类型的网络连接在一起形成一个更大的网络）

- 拥塞控制：若所有分组都来不及接收分组，而要大量丢弃分组的话，网络就处于拥塞状态，这时需要措施来解决这个拥塞。

  其中有：开环控制（静）和闭环控制（动）

<br/><br/><br/><br/>

### 2.数据交换方式

<br/>

 网络的核心是路由器

<br/>

##### ① 电路交换

<br/>

电路交换：就是两个电话通过拨号和接听建立一个固定的线路来进行数据传输。

在此线路中如果线路带宽较大，可以采用多路复用技术，使得其他电话之间也可以使用这条线路，但是在其中两台电话通信期间，他们所占的多路复用区段只能他们用，并且即使他们不发送信息，他们也占用这条线路，当其中一方挂掉电话之后，就释放他们所占的区段。

<br/>

电路交换有三个阶段：

建立连接（呼叫/电路建立）—>    通信  —>    释放连接（拆除线路）

<br/>

特点：独占资源

<br/>

优点：通信时延小，有序传输，没有冲突，实时性强

缺点：建立连接时间长，线路独占使用效率低，灵活性差，无差错控制能力

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet74.png" alt="image-20211109201848312" style="zoom: 50%;" />

<br/><br/>

##### ② 报文交换

<br/>

报文：原应用发送的信息整体

报文交换：在不建立连接的情况下，把一整个报文通过线路和交换设备直接发送给接收方。

过程：源发送一个数据，先到第一个交换设备等全部收到后，通过路由算法和目的地址决定下一步发到哪一个地址，在继续下一个站点发送，下一个站点是交换设备的话就同样的过程（等收完后再发到下一个），如果是目的地址处就发送完成。

<br/>

优点：

- 无需建立连接
- 存储转发，动态分配线路
- 线路的可靠性较高
- 线路的利用率较高
- 多目标服务

缺点：

- 有存储转发时延
- 报文大小不定，需要网络节点有较大的缓存空间

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet75.png" alt="image-20211109202435604" style="zoom:50%;" />

<br/><br/>

##### ③ 分组交换

<br/>

分组交换：和报文交换差不多，只是将数据进行了一个分组，使得每段数据较小，这样每个交换设备就无需太大的缓存空间，并且在交换设备接收和发送数据时就可以不用等待很久收到一个就发一个。

相当于减少了必须等到全部信息后才能发送到下一个站点的时间，由此提高了传输效率。

<br/>

**分组交换方式分为：数据报交换方式和虚电路交换方式**

<br/>

下图，发送10000bit的数据，采用报文交换时，直接全部发送。采用分组交换时，先分为1000份，再发送。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet76.png" alt="image-20211109203604879" style="zoom: 67%;" />

<br/>

计算题中注意事项：

- 单位换算
- 是否考虑传播时延
- 时间至少是多少——选择路由器最少的线路
- 起始时间（从发送数据开始到接收完毕/发送完毕为止）
- 是否有分组头部大小的开销 
- 报文交换时延更长，分组交换时延可能不是整数

<br/><br/>

##### ④ 数据报和虚电路

<br/>

数据报和虚电路是两种分组交换的方式

<br/>

数据包方式为网络层提供无连接服务

虚电路方式为网络层提供连接服务

无连接服务：不事先为分组的传输确定传输路径，每个分组独立确定传输路径，步同分组的传输路径可能不同

连接服务：首先为分组的传输确定路径（建立连接），然后沿着该路径（连接）传输系列分组，系列分组的传输路径相同，传输结束后拆除连接

<br/>

| 层         | 传输类型                               |
| ---------- | :------------------------------------- |
| 应用层     | 报文                                   |
| 传输层     | 报文段（将报文分段成为报文段）         |
| 网络层     | IP数据报，过大就分成一个个小的称为分组 |
| 数据链路层 | 帧                                     |
| 物理层     | 比特流                                 |

<br/>

###### 1）数据报

<br/>

无连接

每个分组携带源地址和目的地址

路由器根据分组的目的地址转发分组：基于路由协议/算法构建转发表；检索转发表；每个分组选路

<br/>

过程：路由器就根据路由协议/算法构建转发表（只要有路由器，路由器就会自己构建）首先，数据分组后发送出去，每个携带源地址和目的地址，到达路由器后检索转发表，将数据根据自己的转发表转发出去，最终到达。这里面，不同分组的路径可能是不一样的，到达的顺序也可以不按序号。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet78.png" alt="image-20211109213242486" style="zoom:67%;" />

<br/><br/>

###### 2）虚电路

<br/>

虚电路是将数据报方式和电路交换方式结合，以发挥两者优点

<br/>

虚电路：一条源地址到目的主机的虚拟电路，类似于电路的建立（逻辑连接），路径上所有结点都要维持虚电路的建立，都维持一张虚电路表，每一项记录一个打开的虚电路的信息。

<br/>

通信过程：源主机发送“呼叫请求”分组并接收到“呼叫应答”分组后建立连接，形成一条虚电路，这条虚电路上的路由器的虚电路表记录着这条电路的信息，在虚电路建立后，再将分组发送，所有分组都按着这条线路有序传输。

<br/>

三个阶段：

建立连接（虚电路建立）—>  数据传输 —>  释放连接（虚电路释放，源主机发送“释放请求”，分组以拆除虚电路）

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet79.png" alt="image-20211109214640694" style="zoom:67%;" />

<br/><br/>

##### ⑤ 总结

<br/>

报文交换和分组交换都采用存储转发

传送数据量大，且传送时间远大于呼叫时，选择电路交换。电路交换时延最少

从信道利用率看，分组交换和报文交换优于电路交换，其中分组交换时延更少

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet77.png" alt="image-20211109204749034" style="zoom:67%;" />



<br/><br/><br/><br/>

### 3.IP数据报格式

<br/>

##### ① TCP/IP协议栈

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet80.png" alt="image-20211111121239853" style="zoom:67%;" />



<br/><br/>

##### ② IP数据包格式

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet81.png" alt="image-20211111121817113" style="zoom:67%;" />

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet82.png" alt="image-20211111121916278" style="zoom:67%;" />

<br/>

- 版本：IPV4/IPV6
- 首部长度：单位是4B，最小为5，意思是这个属性记录首部长度，以32比特为单位，比如首部是24字节，那首部长度就是6X4B，首部长度处值就是0110，因为首部长度最小是20B，所以首部长度处值最小为：20 / 4 = 5.
- 区分服务：指示期望获得哪种类型的服务
- 总长度：首部+数据，单位是1B
- 生存时间（TTL）：IP分组的保质期。经过一个路由器就减一，编程0则丢弃
- 协议：数据部分的协议，字段值：UDP（17），TCP（6）等

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet83.png" alt="image-20211111124657438" style="zoom:67%;" />

<br/>

- 首部检验和：只对首部数据进行检验，每到一个路由器后，TTL-1，这个首部检和也要重新计算一下
- 源地址/目的地址：32位
- 可选字段：0~40B，用来支持排错测量以及安全等措施
- 填充：填0，使首部长度为4B的整数倍（因为首部长度以4B为单位）

<br/><br/>

##### ③ IP数据包分片

<br/>

链路层数据帧可封装的字节数是有上限的，当IP数据报超过这个上限时需要进行分片

<br/>

- 标识：同一数据报的分片使用同一标识

- 标志：只有两位有意义：X __ __

  ​           中间位DF（Don't Fragment）

  ​           DF=1，禁止分片

  ​           DF=0，允许分片

  ​           最低为MF（More Fragment）

  ​           MF=1，后面还有分片

  ​           MF=0，后面没有分片

  当DF=1时，后面的MF是没有意义的

- 片偏移：指出较长分组分片后，某片在原分组中的相对位置，以8B为单位

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet85.png" alt="image-20211111125702468" style="zoom:67%;" />

<br/><br/><br/><br/>

### 4.IPv4地址

<br/>

#### （1）概念

<br/>

IP地址：全世界唯一的32位/4字节标识符，标识路由器主机的接口

IP地址::= {<网络号><主机号>}

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet86.png" alt="image-20211111213726403" style="zoom: 50%;" />

<br/>

在同一网络中，网络号相同。

由网桥连接的区域属于同一网络

一个路由器每一个接口对应一个ip地址

<br/><br/><br/><br/>

#### （2）IP地址分类

<br/>

通过IP的前几位判断属于哪类IP

（1~126）表示IP地址的第一个点前面的数字是1~126之间，比如：10.1.1.1的第一个点之间是10，这就是A类IP地址

1B表示网络号的长度

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet87.png" alt="image-20211111215010454" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （3）特殊IP地址

<br/>

本网表示主机所在的网络

特定值就是不是特殊值（不是全1，全0）

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet88.png" alt="image-20211111215125883" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （4）私有IP地址

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet89.png" alt="image-20211111215222267" style="zoom:67%;" />

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet90.png" alt="image-20211111215313662" style="zoom:67%;" />

<br/><br/><br/><br/>

### 5.网络地址转化NAT

<br/>

NAT：网络地址转换，在专用网连接到因特网的路由器上安装NAT软件，安装NAT软件的路由器叫NAT路由器，它至少有一个外部全球IP地址。

NAPT：网络地址与端口号转换

注：使用了端口号的NTP实际是NAPT，没有用端口号的叫传统的NAT

<br/>

使用NAT/NAPT转化地址和端口号的原因：路由器对目的地址是私有地址的IP数报一律不进行转发，只有私有IP地址通过NAT路由器转化为NAT路由器的地址才能被互联网识别，才能与外部进行数据交换。

<br/>

| 方向               | 字段                    |
| ------------------ | ----------------------- |
| 从专用网发往互联网 | 源IP地址：TCP源端口     |
| 从互联网发往专用网 | 目的IP地址：TCP目的端口 |

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet91.png" alt="image-20211111222004307" style="zoom:67%;" />

<br/><br/><br/><br/>

### 6.子网掩码和一些协议

<br/>

#### （1）子网划分和子网掩码

<br/>

划分子网的原因：

- IP地址空间的利用率有时很低
- 两级IP地址不够灵活

<br/>

原有两级IP{<网络号><主机号>}

**划分子网后{<网络号><子网号><主机号>}**

注：子网号能够全0或全1要看情况

某单位划分子网后，对外表现为一个网络，即本单位外的网络看不见子网的划分

<br/>

**子网掩码**：用来指明一个IP地址哪些位是主机所在的子网，规定在A（B，C，D，E）类IP等后面的主机位中哪些是子网的标识位

子网掩码用前面全1.后面全0的方式表示，求子网号的过程就是相与

比如：B类IP：172.10.233（11101001）.10 的子网掩码是255.255.240（11110000）.0,就是说170.10是B类网络号，第三个字节的前4位是子网号，所以这个IP地址的子网号就是170.10.1110，主机号是后12位

<br/>

路由表：

有这三个组成部分：

| 目的IP地址 | 子网掩码 | 网关 |
| ---------- | -------- | ---- |
|            |          |      |

<br/>

路由器转发分组算法：

1）从收到的分组首部提出目的IP地址的D

2）先判断是否直接交付，用那些和路由器直接相邻的网络子网掩码和D按位与，如果结果与目的网路地址相同，那将分组直接交付，否则就是简介交付，转到3)

3）如果路由表中有目的地址为D的特定路由，则将分组转给指明的下一跳路由器，否则转到4）

4）对路由表中的每一行的子网掩码与D按位与，若匹配，则将分组转给下一个路由器，否则转到5）

5）若路由表中有一默认路由（0.0.0.0），则将分组转到默认路由，否则报告分组出错

<br/><br/><br/><br/>

#### （2）无分类编址CIDR

<br/>

无类域间路由CIDR：一种有效分配IP地址的方法。

<br/>

特点：

- 它不区分A类，B类等地址以及划分子网的概念。
- 融合子网地址子网掩码，方便子网划分。CIDR把前缀相同的连续的IP地址组成一个“CIDR地址块”

<br/>

CIDR记法：IP地址后面加上 “/” ,然后写上网络前缀（可以是任意长度）的位数。

比如：128.14.32.0/20，/20就是表示它的前20位都是网络前缀，他的子网掩码就是11111111 11111111 11110000 00000000

<br/>

**采用两级IP{<网络前缀><主机号>}**

<br/><br/>

**构建超网**

定义：将多个子网聚合成一个较大的子网，叫做构成超网或路由聚合

比如：连载一个路由器不同接口的两个网络的IP为：206.1.0.0/17，206.1.127.0/17，前16位相同，第17位一个0，一个1，这样可以将这两个网络规划为一个超网206.1.0.0/16

注：使用CIDR时，查找路由表可能得到几个匹配结果，应当选择具有最长网络前缀的路由。前缀越长，地址块越小，路由越小，路由越具体

<br/><br/><br/><br/> 

#### （3）ARP协议

<br/>

定义：地址解析协议，完成主机或路由器从IP地址到MAC地址的映射。

ARP不止限于主机与主机之间，还有主机和路由器，路由器和路由器

<br/>

使用过程：

在的到数据后在头部添加源IP地址和目的IP地址，在将源MAC地址加入，此时查找ARP高速缓存，有对应项直接写入目标MAC地址，没有的话将目的MAC地址写为FF-FF-FF-FF-FF-FF进行广播ARP请求分组，同一局域网中所有主机都能收到该请求，解析后只有IP地址和自己符合的才会进行接收，然后向源主机单播一个ARP响应分组，源主机接收后将此映射写入ARP缓存（10~20min更新一次）。

拥有MAC地址就可以进行信息交互等操作。

<br/>

**详解：**

<br/>

在进行操作之前首先会将目的IP地址与自己的子网掩码进行与，看是否在自己的网段，如果是就直接进行如下操作，如果不是就不直接获得目的主机的MAC地址，而是将路由器的MAC地址代替目的MAC地址，再由路由器作为源地址向外进行查找。

1）当pc1要和pc2通信的时候，如果pc1的缓存表中有pc2的记录，则直接将pc2的mac地址放入目的mac地址中，直接发送相关的数据包。如果pc1的ARP缓存表中没有pc2的记录，就会发起一个ARP请求。

2）pc1会将自己的IP地址和MAC地址填入ARP请求分组的源字段中，同时将pc2的IP地址填入ARP请求分组的目的IP字段中，并且将目的MAC地址置空（即设置成全为0）。 同时将pc1的MAC地址填入到数据链路帧的源MAC字段中，将数据链路帧的目的MAC字段置成广播地址（即全为1）。这样同一个网络中的所有主机都会收到这个ARP请求分组。

3）所有接收到ARP请求分组的主机都会对该ARP请求分组进行处理，如果ARP请求分组中的IP地址和自身的不匹配则直接抛弃，除了pc2。

4）pc2收到了ARP请求分组，就知道了是想要自己的MAC地址，因此就会封装一个ARP响应分组用于响应这个ARP请求分组。 pc2会将自己的IP地址和MAC地址填入到ARP响应分组的源IP和源MAC字段中，同时将pc1的IP和MAC填入到ARP响应分组的目的IP和目的MAC字段中（pc1的信息可以在pc1发出的ARP请求分组中得知）。同时将pc2的MAC地址和pc1的MAC地址填入到数据链路帧的源MAC和目的MAC字段中。最后将ARP响应分组以单播的形式发出（因为目的MAC是知道的所以只需要用单播即可）。 同时pc2还会做一件很重要的事情，就是将pc1的MAC和IP的信息保存到pc2的ARP缓存表中，至于为什么要这么做大家应该都可以想到。

5）pc1收到了ARP响应分组之后就知道pc2的MAC地址了这样pc1就可以和pc2发起通信了。同时pc1也会将pc2的MAC和IP的信心保存到pc1的ARP缓存表中。

上面说了这么多，实际上总结一下就是一句话：**ARP请求采用广播发送, ARP响应采用单播发送。**

<br/>

ARP格式：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet94.png" alt="image-20211114133823177" style="zoom: 80%;" />

<br/>

- 硬件类型：16位字段，用来定义运行ARP的网络类型。每个局域网基于其类型被指派一个整数。例如：以太网的类型为1。ARP可用在任何物理网络上。
- 协议类型：16位字段，用来定义使用的协议。例如：对IPv4协议这个字段是0800。ARP可用于任何高层协议
- 硬件长度：8位字段，用来定义物理地址的长度，以字节为单位。例如：对于以太网的值为6。
- 协议长度：8位字段，用来定义逻辑地址的长度，以字节为单位。例如：对于IPv4协议的值为4。
- 操作码：16位字段，用来定义报文的类型。已定义的分组类型有两种：ARP请求（1），ARP响应（2）。
- 源硬件地址：这是一个可变长度字段，用来定义发送方的物理地址。例如：对于以太网这个字段的长度是6字节。
- 源逻辑地址：这是一个可变长度字段，用来定义发送方的逻辑（IP）地址。例如：对于IP协议这个字段的长度是4字节。
- 目的硬件地址：这是一个可变长度字段，用来定义目标的物理地址，例如，对以太网来说这个字段位6字节。对于ARP请求报文，这个字段为全0，因为发送方并不知道目标的硬件地址。
- 目的逻辑地址：这是一个可变长度字段，用来定义目标的逻辑（IP）地址，对于IPv4协议这个字段的长度为4个字节。

<br/>

ARP协议的四种典型情况：

1）主机A发送给本网络的主机B：用ARP查找主机B的硬件地址

2）主机A发送给另一网络上的主机B：用ARP找到本网络上的一个路由器，再由路由器去查找

3）路由器发给本网络的主机A：用ARP找到主机A的硬件地址

4）路由器发送给另一网络的主机B：用ARP找到本网络上的一个路由器的硬件地址

<br/><br/><br/><br/>

#### （4）DHCP协议

<br/>

DHCP：动态主机配置协议

主机如何获得IP地址：

静态配置：IP地址，子网掩码，默认网关

动态配置：由主机向DCHP服务器进行请求IP地址实现动态分配

<br/>

动态主机配置协议DHCP是**应用层**协议，使用**客户/服务器**方式，客户端和服务端通过**广播**方式进行交互，基于**UDP**。

DHCP提供即插即用联网的机制，主机可以从服务器动态获取IP地址，子网掩码，默认网关，DNS服务器名称与IP地址，允许地址重用，支持移动用户加入网络，支持在用地址续租。

<br/>

步骤：

1）主机广播DHCP发现报文。相当于是主机问“有没有DHCP服务器？”，试图找到网络中的服务器，服务器获得一个IP地址

2）DHCP服务器广播DHCP提供报文。服务器回答：”有有有“，服务器拟分配给主机一个IP地址及相关配置，先到先得。

3）主机广播DHCP请求报文。主机回答：”我用你给我的IP地址了“，主机向服务器请求提供IP地址

4）DHCP服务器广播DHCP确认报文。主机回答：”用吧“，正式将IP地址分配给主机。

当设备离开这个网络后或时间到期后，就会将这个IP地址释放，其他主机也可以使用这个IP地址

<br/><br/><br/><br/>

#### （5）ICMP协议

<br/>

ICMP：网络控制报文协议,用于TCP/IP网络中发送控制信息，提供可能发生在通信环境中的各种问题反馈，通过这些消息可以使网络管理者可以对多发生的问题进行诊断，然后才去适当的问题进行诊断。

<br/>

功能：差错（或异常）报告，网络探寻

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet95.png" alt="image-20211114162034046" style="zoom:67%;" />

<br/>

分类：

1）差错控制报文

- 终点不可达：当路由器或主机不能交付数据报时就向主机发送重点不可达报文.（送不到）
- 时间超过：当路由器收到生存时间TTL=0的数据报时，除了丢弃数据报外，还要向源点发送时间超过报文。当终点在预先规定的时间内没有收到一个数据报的全部数据报片时，就把已收到的数据报片全部丢弃，并向源点发送时间超过报文（TTL=0）
- 参数问题：当路由器或目的主机收到数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文（首部字段有问题）
- 改变路由（重定向）：路由器把改变路由报文发给主机，让主机知道下次应当把数据报发给另外的路由器（可以有更好的路由）
- （这个不怎么用了）源点抑制：当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送频率变慢一些

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet96.png" alt="image-20211114163050268" style="zoom:67%;" />

<br/>

解释：将收到的IP数据报的首部以及首部后面的8个字节取出来，与ICMP的前8个字节组合成ICMP差错报告报文，在将ICMP作为数据部分加上新形成的IP数据报首部形成一个蕴含ICMP差错报告的IP数据报

<br/>

不应该发送ICMP差错报告报文的情况：

- 对ICMP差错报告报文不再发送ICMP差错报告报文
- 对第一个分片的数据报片的后面所有后续数据报片都不发送ICMP差错报告报文
- 对具有组播地址的数据报都不发送ICMP差错报告报文
- 对具有特殊地址（如：127.0.0.0或0.0.0.0）的数据报不发送ICMP差错报告报文

<br/><br/>

2）ICMP询问报文

- 回送请求或回答报文：主机或路由器向特定主机发出的询问，收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。测试目的站是否可达以及了解相关状态
- 时间戳请求和回答报文：请某个主机或路由器回答当前的日期和时间

<br/>

主要应用：

- ping：测试两个主机的连通性，使用了ICMP回送请求和回答报文

- traceroute：跟踪一个分组从源点到终点的路径，使用ICMP时间超过差错报告报文

  原理：主机依次发送TTL=1，2，3.....的数据报，当依次到达路由器后由于TTL会减1，当TTL=0就会产生时间超过差错报文返回给主机，由此知道路径

<br/><br/><br/><br/>

### 7.IPv6地址

<br/>

出现IPv6的原因：

32位的IPv4地址空间已分配殆尽，采用CIDR和NAT等技术又治标不治本，所有需要从根本上解决地址殆尽的问题，直接分配一个不可能用完的IP地址

IPv6改进了首部格式，快速处理/转发数据报，支持Qos

Qos（服务质量）：指一个网络能够利用各种基础技术，为指定的网络通信提供更好的服务能力，是网络的一种安全机制，是用来解决网络延迟和阻塞问题的一种技术。

<br/>

IPv6数据报格式：

固定40B基本首部

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet97.png" alt="image-20211115150658796" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet99.png" alt="image-20211115150658796" style="zoom: 50%;" />

<br/>

- 版本：指明了协议版本，总是6
- 优先级：区分数据报的类别和优先级
- 流标签：“流”是互联网络上从特定源点到特定终点的一系列数据报。所有属于同一流的数据报都具有同样的流标签
- 有效载荷长度：就是最底部有效载荷的长度
- 下一个首部：表示下一个扩展首部或上层协议首部
- 条数限制：相当于IPv4的TTL

<br/>

IPv6和IPv4对比：

- IPv6降低至从32位（4B）扩大到128位（16B），有了更大地址空间
- Ipv6将IPv4的校验和字段彻底移除，以减少每一跳的处理时间
- IPv6将IPv4的可选字段移出首部，变成了**扩展首部**，成为了灵活的首部格式，路由器通常不对扩展首部进行检查，大大提高了路由器的处理效率
- IPv6实现了**即插即用**（即自动配置），不需要DHCP协议
- **IPv6首部必须是8B的整数倍**，IPV4首部是4B的整数倍
- **IPv6只能在主机处分片**，IPv4可以在路由器和主机处分片
- ICMPv6：附加报文类型“分组过大”
- IPv6支持资源的预分配，支持实时视像等要求，保证一定宽度和时延的应用
- IPv6取消了协议字段，改成下一个首部字段
- IPv6取消了总长度字段，改用有效载荷长度字段

<br/>

IPv6地址表示形式：

一般形式：冒号16进制记法：4B5F：AA12：DC76：9087：0000：89A7：AA12：DC76

压缩形式：

冒号零压缩在一个式子中只能使用一次

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet100.png" alt="image-20211115152808604" style="zoom:67%;" />

<br/>

IPv6基本地址类型：

- 单播：一对一通信，可做源地址+目的地址
- 多播：一对多通信，可做目的地址
- 任播：一对多中的一个通信（通常是最近的一个），可做目的地址

<br/>

IPv6向IPv4过度的策略：

- 双栈协议：双协议栈技术就是指在一台设备上同时启用IPv4协议栈和IPv6协议栈。这样的话，这台设备既能和IPv4网络通信，又能和IPv6网络通信。如果这台设备是一个路由器，那么这台路由器的不同接口上，分别配置了IPv4地址和IPv6地址，并很可能分别连接了IPv4网络和IPv6网络。如果这台设备是一个计算机，那么他将同时拥有IPv4地址和IPv6地址。并具备处理这连个协议地址的功能。

- 隧道协议：通过使用互联网的基础设施在网络之间传递数据的方式。使用隧道传输的数据（或负载）可以是不同协议的数据包和数据帧。隧道协议将其他协议的数据帧或包重新封装然后通过隧道发送。

  比如下图，左边主机发送一个IPv6形式的数据报，到达IPv6路由器就直接继续向下发送，到达第二个IPv4路由器后先将发来的IPv6数据报加一个首部转化为IPv4数据报，再继续向下一个路由器发送给，达到后面的IPv6数据报后再将首部去掉，再传输给主机

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet101.png" alt="image-20211115154103294" style="zoom:67%;" />

<br/><br/><br/><br/>

### 8.路由算法与路由协议概述

<br/>

#### （1）概述

<br/>

路由表/转发表：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet92.png" alt="image-20211114103805378" style="zoom:67%;" />

<br/>

最佳路由：“最佳”只能是相对于某一种特定要求下的出的比较合理的选择。

<br/>

**路由算法的分类：**

- 静态路由算法（非自适应路由算法）：管理员手动配置路由信息

  ​                    简便，可靠，在负荷稳定。拓扑变化不大的网络中运行效果更好，广泛用于高度安全性的军事网络和较小的商业网络

  ​                    路由更新慢，不适合大型网络

- 动态路由算法（自适应路由算法）：路由器间彼此交换信息，按照路由算法优化出路由表项

  ​                     路由更新块，，使用大型网络，及时响应链路费用或拓扑变化

  ​                     算法复杂，增加路由负担

<br/>

动态路由算法：

- 全局性：链路状态路由算法OSPF

  ​               所有路由器掌握完整的网络拓扑和链路费用信息

- 分散性：距离向量路由算法RIP

  ​               路由器只掌握物理相连的邻居及链路费用

<br/>

分层次的路由选择协议：

- 因特网规模很大
- 许多单位不想让外界知道自己路由选择协议，但还想连入互联网

<br/>

自愈系统AS：在单一的技术管理下的一组路由器，而这些路由器使用一种AS内部的路由选择协议和共同的度量以确定分组在该AS内的路由，同时还使用一种AS之间的路由协议以确定在AS之间的路由。

一个AS内的所有网络都属于一个行政单位来管辖，一个自治系统的所有路由器在本自治系统内都必须连通。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet93.png" alt="image-20211114110116533" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （2）RIP协议与距离向量算法

<br/>

##### ① RIP协议

<br/>

定义：路由信息协议，一种分布式的基于**距离向量**的路由选择协议，是因特网的协议标准，是因特网的协议标准，最大的优点是简单。

RIP协议要求网络中每一个路由器都要维护从他自己到其他每一个目的网络的唯一最佳距离记录。

距离：简称跳数，即从源端口有到目的端口所经过的路由器个数，经过一个路由器跳数+1。特别的，从一路由器到直接连接的网络距离为1。RIP允许一条路由最多只能包含15个路由器，因此距离16表示不可达。

注：RIP协议只适用与小型互联网

<br/>

特点：

- 仅和相邻路由器交换信息
- 路由器交换的信息是自己的路由表
- 每30秒交换一次路由信息，然后路由器根据新信息更新路由表。若超过180s没有接收到邻居路由器的通告，则判定邻居没了并自己更新路由表
- 路由器在刚开始工作时，只知道直接连接网络的距离（距离为1），接着每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息；经过若干次交换之后，所有路由器最终都会知道到达本自治系统任何一个网络的最短距离和下一跳路由器的地址，即”收敛“。

<br/>

特别记住的特点：好消息传得快，坏消息穿得慢

因为，比如当一个路由器或网络出现故障不可达后，相邻得路由器就会将自己与这个地方得距离记为16，但它还没将这个消息发出去，别得路由器因为不与出现故障得地方相连，就以为还是可以到的，就发给那个知道不可到的路由器，路由器一看，你可以到达，就根据距离路由算法把自己的16数据给改了，这两个路由器就一直相互交换数据，直到让距离一点点加到16才知道原来到不了，这就是坏消息传的慢。

<br/>

数据报格式：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet105.png" alt="image-20211115162004541" style="zoom: 50%;" />

<br/><br/>

##### ② 距离向量算法

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet102.png" alt="image-20211115161017101" style="zoom:67%;" />

<br/>

1）修改相邻路由器发来的RIP报文中的所有表项

对地址为X的相邻路由器发来的RIP报文，修改此报文中的所有项目：把下一跳字段中的地址改为X，并把所有的”距离“字段+1

2）对修改后的RIP报文中的每一个项目，进行如下步骤：

​      <1> R1路由表中如果没有Net3，则把该项目填入R1的路由表

​      <2> R1路由表中如果有Net3，则查看下一跳路由器地址

​              a.如果下一跳地址是X，则用收到的项目替换源路由表中的项目

​              b.如果下一跳地址不是X，则比较两项中的距离，如果距离比原表中的距离小就更新，否则不更新

3）若180s还没有收到相邻路由器X的更新路由表，则把距离设置为16

4）返回

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet103.png" alt="image-20211115161654830" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet104.png" alt="image-20211115161842542" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （3）OSPF协议及链路状态算法

<br/>

##### ① OSPF协议

<br/>

定义：开放最短路径优先协议，“开放”标明协议不是受某一厂商控制，而是公开发表的，“最短路径优先”是因为使用了Dijkstra提出的最短路径算法SPF

OSPF最主要的特征就是是用了分布式的链路状态协议

<br/>

OSPF协议的特点：

- （和谁交换）使用洪范法向自治系统内所有路由器发送信息，即路由器通过输出端口向所有**相邻的路由器**发送信息，而每一个相邻路由器又再次将此信息发送到它所相邻的路由器。最终整个区域内所有路由器都得到这一信息的副本
- （交换什么）发送等信息就是与本路由器相邻的所有路由器的链路状态（本路由器与哪些路由器相邻，以及该链路的度量/代价—费用，距离，时延，带宽等）
- （多久交换）只有当链路状态发生变化时，路由器才向所有路由器洪范发送此信息

最后，所有路由器都能建立一个链路状态的数据库，即全网拓扑图

<br/>

OSPF区域

为了使OSPF能够用于规模很大的网络，OSPF将一个自治系统在划分为若干个更小的范围，叫做区域。

每一个区域都有一个32位的区域标识符（用点分十进制标识）

区域也不能太大，在一个区域中的路由器最好不超过200个。

<br/>

区域内部路由器：在一个区域内部的路由器叫做区域内部路由器

区域边界路由器：在两个区域交接处的路由器叫做区域边界路由器

主干路由器：在主干区域中的路由器叫做主干路由器

自治系统边界路由器：与其他自治系统相连的路由器叫做自治系统边界路由器

注：

主干路由器个自治系统边界路由器或区域区域边界路由器并不冲突，一个路由器可以都是

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet106.png" alt="image-20211116143121067" style="zoom:67%;" />

<br/>

OSPF分组：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet107.png" alt="image-20211116144043616" style="zoom:67%;" />

<br/>

OSPF的其他特点：

- 每个30分钟，要刷新一次数据库中的状态
- 由于一个路由器的链路状态只涉及到与相邻路由器的连通状态，因而与整个互联网的规模并无直接关系。因此当互联网规模很大的时候，OSPF协议要不距离向量RIP好很多
- OSPF不存在换消息穿的慢的问题，他的收敛速度很快

<br/><br/>

##### ② 链路状态路由器算法

<br/>

1）每个路由发现他的邻居结点【HELLO问候分组】，并了解邻居结点的网络地址

2）设置到它的每个邻居的成本度量metric

3）构建【DD数据库描述分组】，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。

4）如果DD分组中的摘要自己都有，则邻站不做处理；如果没有的或者是更新的，则发送【LSR链路状态请求分组】请求自己没有的和比自己更新的信息

5）收到邻站的LSR分组后，发送【LSU链路状态更新分组】进行更新

6）更新完毕后，邻站返回一个【LSAck链路状态确认分组】进行确认

只要有一个路由器的链路状态发生变化：

5）泛洪发送【LSU链路状态更新分组】进行更新

6）更新完毕后，其他站返回一个【LSAck链路状态确认分组】进行确认

7）使用Dijkstra根据自己的链路状态数据库构造到其他路径的最短路径

<br/><br/><br/><br/>

#### （4）BGP协议

<br/>

定义：边界网关协议

<br/>

BGP协议的特点：

- （和谁交换）与其他AS的邻站BGP发言人交换信息
- （交换什么）交换的网络可达性的消息，即要到达某个网络所经过的一系列AS
- （多久交换）发生变化时更新有变化的部分

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet108.png" alt="image-20211116145650527" style="zoom:67%;" />

<br/>

BGP协议交换信息的过程：

BGP所交换的网络可达性的信息就是要到达某个网络所要经过的一系列AS。当BGP发言人相互交换了网络可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信息中找出到达各AS的最好路由

BGP协议之间交换的是 **路径向量**，告诉其他BGP发言人到达一个网络可以通过那一条路径经过哪些自治系统，

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet109.png" alt="image-20211116150042590" style="zoom: 67%;" />

<br/>

BGP协议的报文格式：

一个BGP发言人与其他自治系统中的BGP发言人要交换路由信息，就要先建立TCP连接，即通过TCP传送，然后再此连接上交换BGP报文以建立BGP会话。

BGP是应用层的协议，借助TCP传送。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet110.png" alt="image-20211116152317615" style="zoom: 50%;" />

<br/>

BGP协议特点：

- BGP支持CIDR，因此BGP的路由表也就应当包括目的网络前缀，下一跳路由器，以及到达该目的网络所要经过的各个自治网络系统序列
- 再BGP刚刚运行时，BGP的邻站是交换整个的BGP路由表。但以后只需要在发生变化时更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处

<br/>

BGP-4的四种报文：

- OPEN（打开）报文：用来与另一个BGP发言人建立关系，并认证发送方
- UPDATE（更新）报文：通告新路径和撤销源路径
- KEEPALIVE（保活）报文：在无UPDATE时，周期性证实邻站的连通性，也可作为OPEN的确认
- NOTIFICATION（通知）报文：报告先前报文的差错；也可用于关闭连接

<br/><br/><br/><br/>

#### （5）三种协议比较

<br/>

RIP是一种分布式的基于距离向量的内部网关路由选择协议，通过广播UDP报文来交换路由信息

<br/>

OSPF是一个内部网关协议，要交换的信息量较大，应使报文的长度尽量短，所以不使用传输层协议（如UDP，TCP），而是直接使用IP

<br/>

BGP使一个外部网关协议，在不同的自治系统之间交换路由信息，由于网络环境复杂，需要保证可靠传输，所以采用TCP

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet111.png" alt="image-20211116153633907" style="zoom:67%;" />

<br/><br/><br/><br/><br/>

### 9.IP组播

<br/>

#### （1）概念

<br/>

IP数据报的三种传输方式：

单播：单播用于发送数据包到单个目的地，且每发送一份单播报文都使用一个单播IP地址作为目的地址。是一种点对点传输方式

广播：广播是指发送数据包到同一广播域或子网内的所有设备的一种数据传输方式，是一种点对多点传输方式

组播：当网络种中某些用户需要特定数据时，组播发送者只发送一次数据，借助组播路由协议为组播数据包建立组播分发树，被传递的数据到达距离用户端尽可能近的结点后开始复制和分发，是一种点对多点传输方式

<br/>

单播是在发送者和每一接收者之间需要单独的数据通道

组播提高了数据的传输效率，减少了主干网出现拥塞的可能性。组播组中的主机可以是在同一物理网络中，也可以是来自不同的物理网络（来自不同网络需要组播路由器的支持）

<br/>

IP组播在两层传播：

- 因特网范围内组播
- 硬件组播

<br/><br/><br/><br/>

#### （2）IP组播地址

<br/>

IP组播地址让原设备能够将分组发送给一组设备。属于多播组的设备将被分配一个组播IP地址（一群共同需求主机的相同标识）

组播地址范围为：224.0.0.0 ~ 239.255.255.255（D类地址），一个D类地址标识一个组播组。只能用作分组的目标地址，源地址仍必须是单播地址

<br/>

特点：

- 组播数据报也是“尽最大努力交付”，不提供可靠交付，应用于UDP
- 对组播数据报不产生ICMP差错报文
- 并非所有D类地址都可以作为组播地址，有的地址已经被指派为永久组地址

<br/><br/><br/><br/>

#### （3）硬件组播

<br/>

同单播地址一样，组播地址也需要相应的组播MAC地址在本网络中实际传送帧。

组播MAC地址以十六进制值：**01-00-5E** 打头，余下的6个十六进制为是根据IP组播地址的最后 **23** 位转换得到

TCP/IP协议使用的以太网多播地址的范围：从 01-00-5E-00-00-00 到 01-00-5E-7F-FF-FF

<br/>

收到多播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接受的数据报丢弃，因为IP地址中有5位没有用到导致这5位即使不同也会被认为是同一地址

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet112.png" alt="image-20211116210914632" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （4）IGMP协议

<br/>

定义：网络组管理协议，作用是知道本局域网上是否有主机（的进程）参加或退出了某个组播组

<br/>

IGMP工作的两个阶段：

1）第一阶段

某个主机要加入组播组时，该主机向组播组的组播地址发送一个IGMP报文，声明自己要成为该组的成员。

本地组播路由器接收到IGMP报文后，要利用组播路由器选择协议把这组成员关系发送给因特网上的其他组播路由器

2）第二阶段

本地组播路由器周期习惯探寻本地局域网上的主机，以便知道这些主机是否还是组播组的成员。

只要有一个主机对某个组响应，那么组播路由就认为这个组是活跃的；如果经过几次探询后没有一个主机响应，组播路由器就认为本网络上的没有此组播组的主机，因此就不再把这组成员关系发送给其他的组播路由器。

<br/>

注：组播路由器知道的成员关系只是所连接的局域网中无组播组的成员

<br/><br/><br/><br/>

#### （5）组播路由选择协议

<br/>

组播路由选择协议的目的是找出源主机为根节点的组播转发树

构造树可以避免在路由器之间兜圈子

不同的多播组对应于不同的多播转发树；同一个多播组，对不同的源点也会有不同的多播转发树

<br/>

此协议常用的三种算法：

- 基于链路状态的路由选择
- 基于距离-向量的路由选择
- 协议无关的组播（稀疏/密集）

<br/><br/><br/><br/>

### 10.移动IP

<br/>

概念描述：

A，B 同学多年不见，这时A结婚了，要向B发送请帖，可是A不知道B的具体位置，就只能向B的家里发送请帖，让B的父母转交给B，整个过程类似于B在家中有一个固定IP，但只有他的父母知道，这时B向A发送信息，由于不知道B的具体IP地址只能发送给他父母，再让他父母将这个信息通过内部B的IP地址转交给B，实现通信。

<br/>

移动IP相关术语：

移动IP技术是移动结点（计算机/服务器）以 固定的网络IP地址 ，实现跨越不同网段的漫游功能，并保证了基于网络IP的网络权限在漫游过程中不发生任何改变。

移动结点：具有永久IP地址的移动设备

归属代理（本地代理）：一个移动节点拥有的“居所”称为归属网络，在归属网络中代表移动节点执行移动管理功能的实体叫做归属代理

外部代理（外地代理）：在外部网络中帮助移动节点完成移动管理功能的实体被称为外部代理

永久地址（归属地址/主地址）：移动站点在归属网络中的原始地址

转交地址（辅地址）：移动站点在外部网络使用的临时地址。

<br/>

移动IP通信过程：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet113.png" alt="image-20211116215201516" style="zoom:67%;" />

<br/>

A刚进入外部网络：

1）在外部登记获得一个转交地址，离开时注销

2）在外部代理向本地代理登记转交地址

<br/>

B向A发送数据报：

1）本地代理截获数据报

2）本地代理在封装数据报，新的数据报目的地址是转交地址，发给外部代理（隧道）

3）外部代理拆封数据报并发送给A

<br/>

A给B发送数据报：

1）A用自己的主地址作为数据报的源地址，用B的IP地址作为数据报的目的地址

<br/>

A移动到下一个网络：

1）在新外部代理登记注册一个转交地址

2）新外部代理给本地代理发送新的转交地址（覆盖旧的）

3）通信

<br/>

A回到归属网络：

1）A向本地代理注销转角地址

2）按原始方式通信

<br/><br/><br/><br/>

### 11.网络层设备

<br/>

路由器

路由器是一种具有多个输入端口和输出端口的专用计算机，其任务是转发分组

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet114.png" alt="image-20211117192013607" style="zoom:67%;" />

<br/>

路由选择的功能：根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器之间交换路由信息而不断地更新和维护路由表

交换结构：由路由表和硬件属性得来的转发表，对分组进行转发

分组转发：若收到RIP/OSPF分组等，则把分组送往路由选择处理级；若收到数据分组，则查找转发表并输出

<br/>

输入端口处理：

输入端口中得查找和转发功能在路由器得交换功能总是最重要的

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet115.png" alt="image-20211117192658015" style="zoom:67%;" />

<br/>

输出端口得处理：

若路由器处理分组得速率赶不上分组进入队列得速率，则队列得存储空间必然减少到0，这就使后面再进入队列得分组由于没有存储空间而只能被丢弃

路由器中的输入或输出队列的溢出是造成分组数据丢失的主要原因。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/comopunet116.png" alt="image-20211117192729362" style="zoom:67%;" />

<br/>

三层设备的对比：

路由器：可以连接互联网中不同网络层协议的网段

网桥：可以互联两个物理层和链路层不同的网段

集线器：不能互联两个物理层不同的网段

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet117.png" alt="image-20211117193404140" style="zoom:67%;" />

<br/>

路由表与路由转发：

路由表：根据路由选择算法得出的，主要用途是路由选择，总用软件实现

转发表：根据路由表得来，可以用软件实现，也可以用特殊的硬件来实现。转发表必须包含完成转发功能所必需的信息，在转发表每一行必须包含从要到达的目的地址到输出端口和某些MAC地址信息的映射。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet118.png" alt="image-20211117193624969" style="zoom:67%;" />

<br/><br/><br/><br/><br/><br/><br/><br/>

## （五）传输层

<br/>

### 1.概述

<br/>

定义：为应用层提供通信服务，使用网络层的服务

<br/>

功能：

- 传输层提供进程与进程之间的逻辑通信
- 复用和分用
- 传输层对收到的报文进行差错检测

<br/><br/>

传输层的寻址和端口

复用：应用层所有的应用进程都可以通过传输层再传输到网络层

分用：传输层从网络层收到数据后交付到指明的应用进程

<br/>

端口：是传输层的SAP，标识主机中的应用层进程

端口号只有本地意义，在因特网中不同计算机的相同端口是没有联系的

端口号的长度为16bit，能表示65536个不同的端口号

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet119.png" alt="image-20211117194715289" style="zoom:67%;" />

<br/><br/>

传输层的两个协议TCP和UDP

TCP：面向连接的传输控制协议，传输数据之前必须建立连接，数据传送结束后要释放连接。不提供广播或多播服务。由于TCP要提供可靠的面向连接的传输服务，因此不可避免地增加了许多地开销：确认，流量控制，计时器及连接管理等

特点：可靠，面向连接，时延大，适用于大文件。

<br/>

UDP：无连接的用户数据报协议，传输数据之前不需要建立连接，收到UDP报文后也不需要给出任何确认

特点：不可靠，无连接，时延小，适用于小文件。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet123.png" alt="image-20211117201256166" style="zoom:67%;" />

<br/>

在网络中采用发送方和接收方的套接字组合来识别端点，套接字唯一标识了网络中的一个主机和它上面的一个进程

套接字Socket = （主机IP地址，端口号）

<br/><br/><br/><br/>

### 2.UDP

<br/>

UDP只在IP数据报服务的基础上添加了很少功能，即复用分用和差错检测功能

<br/>

主要特点：

- UDP是无连接的，减少开销和发送数据之间的时延
- UDP使用最大努力交付，即不保证可靠交付
- UDP是面向报文的，适合一次性传输少量数据的网络应用。
- UDP无拥塞控制，适合很多实时应用
- UDP首部开销小，8B，TCP为20B
- 应用层给UDP发送多长的报文，UDP就照样发送，即一次发送一个完整的报文

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet120.png" alt="image-20211117195713539" style="zoom:67%;" />

<br/><br/>

UDP格式：

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet121.png" alt="image-20211117195930895" style="zoom:67%;" />

<br/>

注：

- 源端口号可以为全0，表示只将数据发送过去，而不用对方在发送回来
- UDP长度：表示整个UDP报文的长度，以1B为单位，比如数据为7B，那UDP长度为15B，就填15
- UDP检验和：检验整个UDP数据报在传送时有没有出错，如果出错就丢弃；分用时，找不到相应的目的端口，就丢弃报文，并向发送方发送ICMP“端口不可达”差错报告报文

<br/><br/>

UDP检验

<br/>

伪首部只有在计算检验和时才出现，不向下传送也不向上递交

17：封装UDP报文的IP数据报首部协议字段是17

UDP长度：UDP首部8B+数据部分长度（不包括伪首部）

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet122.png" alt="image-20211117201131348" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet124.png" alt="image-20211117211103437" style="zoom:80%;" />

<br/><br/><br/><br/>

### 3.TCP

<br/>

#### （1）概述

<br/>

定义：面向连接的传输控制协议

<br/>

特点：

- 每一条TCP连接只能是两个点，每一条TCP连接只能是点对点

- TCP提供可靠交付的服务，无差错，不丢失，不重复，按序到达（可靠有序，不丢不重）

- TCP提供全双工通信

   发送缓存：含有准备发送的数据和已发送但未接收到确认的数据

   接收缓存：含有按序到达但尚未被接受应用程序读取的数据和不按序到达的数据

- TCP面向字节流，TCP把应用程序交下来的数据看成仅仅是一连串的无结构的字节流

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet125.png" alt="image-20211118232536194" style="zoom:67%;" />

<br/>

- 序号：在一个TCP连接中传输的字节流中每一个字节都按顺序编号，本字段表示所发送数据第一个字节的序号，比如：数据包含序号为4，5，6的字节，那这个序号部分就填4

- 确认号：期望收到对方下一个报文段的第一个数据字节的序号。若确认号为N，则证明到序号N-1为止的所有数据都已经正确收到

- 数据偏移（首部长度）：TCP报文段的数据起始处距离TCP报文段的起始段有短圆，以4B为单位，比如：数据偏移为7，那首部长度就是28B

- 几个控制字段：

  URG：紧急位，当URG=1时，标明此报文段中有紧急数据，是最高优先级的数据，应尽快传送，不用在缓冲区排队，配合紧急指针进行使用。这个URG=1只是在发送方的缓冲区尽快发送，并不是在接受方的缓存区也尽快取出，如果想尽快取出，要配合PSH。

  ACK：确认位，当ACK为1时，确认号有效，有连接建立后所有传送数据的报文段都必须把ACK置为1
  
  PSH：推送位，当PSH=1时，接收方尽快交付应用进程，不再等到缓存填满后再向上交付。它交付只是将自己进行交付，不用包括在它前面的缓冲区中的数字
  
  RST：复位，当RST=1时，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立传输连接
  
  SYN：同步位，当SYN=1时，表明这是一个连接的请求/连接接受报文。
  
  FIN：终止位，当FIN=1时，表明此报文段发送方数据已发完，要求释放连接
  
- 窗口：指的是发送本报文段的一方的接收窗口，即现在允许对方发送的数据量

- 检验和：检验首部+数据，检验时要加上12B伪首部，第四个字段为6

- 紧急指针：当URG=1时才有意义，指出本报文段中紧急数据的字节数，比如：紧急字数为50，表明从第1个字节到第50个字节都是紧急数据

- 选项：最大报文长度MSS，窗口扩大，时间戳，选择确认.....

- 填充：当首部不是4B的整数倍，就要进行填充0，使是4B的整数倍

<br/><br/><br/><br/>

#### （2）TCP连接管理

<br/>

TCP连接传输三个阶段：

建立连接 —>    数据传送 —> 连接释放

<br/>

TCP连接的建立方式采用客户服务器方式，主动发起连接的应用进程叫做客户，而被动等待连接建立的应用进程叫服务器

<br/><br/>

TCP的连接建立

假如运行在一台主机（客户）上的一个进程想与另一个（服务器）上的一个进程建立一条连接，客户应用进程首先会通知客户TCP，他想建立一个与服务器上某个进程之间的连接，客户中的TCP会用以下步骤与服务器中的TCP建立一条TCP连接。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet126.png" alt="image-20211119140244430" style="zoom:67%;" />

<br/>

步骤：

1）客户端发送连接请求报文段，无应用层数据。SYN=1，seq（序号）=x（随机）

2）服务器端为该TCP连接分配缓存和变量，并向客户端返回确认报文段，允许连接，无应用层数据。SYN=1，ACK=1，seq=y（随机），ack=x+1

3）客户端为该TCP连接分配缓存和变量，并向服务器端返回确认的确认，可以携带数据。SYN=0，ACK=1，seq=x+1，ack=y+1

<br/><br/>

SYN洪泛攻击：

SYN洪泛攻击发送在OSI的第四层，这种方式利用TCP协议的特性，就是三次握手，。攻击者发哦是那个TCP的SYN，SYN是TCP三次握手中的第一个数据报，而当服务器返回ACK后，该攻击就是不对其进行再次确认，那这个TCP连接就会处于挂起状态，也就是所谓的半连接状态，服务器收不到再确认的话，还会重复发送ACK给攻击者。这样会浪费服务器的资源。攻击者就对服务器发送非常大量的这种TCP连接，由于每一个都没法完成三次握手，所以在服务器上，这些TCP连接会因为挂起状态而消耗CPU和内存，最后服务器可能会死机，就无法正常用户提供服务了。

<br/><br/>

TCP连接释放

参与一条TCP连接的两个进程中的任何一个都怒终止连接，连接结束后，主机中的“资源”（缓存和变量）都被释放

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet127.png" alt="image-20211119141845733" style="zoom:67%;" />

<br/>

步骤：

1）客户端发送连接释放报文段，停止发送数据，主动关闭TCP连接。FIN=1，seq=u

2）服务器端返回一个确认报文段，客户到服务器这个方向的连接就释放了——半关闭状态。ACK=1,seq=v.ack=u+1

3）服务器端发送完数据，就发出连接释放的报文段，主动关闭TCP连接。FIN=1，ACK=1，seq=w，ack=u+1

4）客户端回送一个确认报文段，再等到时间等待计时器设置为2MSL（最长报文寿命）后，连接彻底关闭。ACK=1，seq=u+1，ack=w+1

<br/><br/><br/><br/>

#### （3）TCP可靠传输

<br/>

传输层：利用TCP实现可靠传输

网络层：提供最大努力交付，不可靠传输

可靠：保证接收方进程从缓存区读出的字节流与发送方发出的字节流是完全一样的

<br/>

TCP实现可靠传输的机制：

1）检验：与UDP校验一样，增加伪首部

2）序号：一个字节占用一个序号，使数据在接收后，按照序号来判断是不是自己想要的，如果不是接收此数据，继续等待指定序号数据。序号字段是一个报文段第一个字节的序号

3）确认：当接受到数据后，对接收到的数据返回一个确认，如果接受到的目的报文段是后面的报文段，先正常接收，再继续返回目的报文段的字段；如果是目的字段，就返回下一个目的字段的序号。TCP采用的是累计确认，就是在没有接收到目的字段的情况下，对目的字段进行多次确认，当接收到后面的字段确认时，表明前面的字段都已经接收到了。

<br/>

4）重传

重传分为：超时重传和快速重传

超时重传：TCP发送方在规定的时间内没有接收到确认就要重传已经发送的报文段

重传时间：TCP采用自适应算法，动态改变重传时间RTTs（加权平均往返时间）。比如：有四个报文段按序发送，第一个报文段自己计算一个RTTs，第二个报文段发送时，根据第一个报文段和第二个报文段来计算RTTs，后面的也要把前面的都加上计算RTTs

<br/>

快速重传：采用冗余确认的方式进行重传

比如：

每当比期望序号大的失序报文段到达时，发送一个冗余ACK，指明下一个期待字节的序号。

发送方已发送1，2，3，4，5报文段

接收方收到1，返回给1的确认（确认号为2的第一个字节）

接收方收到3，返回给1的确认（确认号为2的第一个字节）

接收方收到4，返回给1的确认（确认号为2的第一个字节）

接收方收到5，返回给1的确认（确认号为2的第一个字节）

发送方收到3个对于报文段1的冗余ACK —> 认为2报文丢失，重传2号报文段

<br/><br/><br/><br/>

#### （4）TCP流量控制

<br/>

流量控制：让发送方慢点，要让接收方来得及接收

TCP利用滑动窗口机制实现流量控制

在通信过程中，接收方根据自己接收缓存的大小，动态地调整发送方的发送窗口大小，即接收窗口rwnd（接收方设置确认报文段的窗口字段来将rwmd通知给发送方），发送方的发送窗口取接收窗口rwnd和拥塞窗口cwnd的最小值

<br/>

A向B发送数据，连接建立时，B告诉A：“我的rwnd=400（字节）”，每一报文段100B，报文段序号初始值为1

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet128.png" alt="image-20211119150310844" style="zoom:80%;" />

<br/>

TCP为每一个连接没有一个持续计时器，只要TCP连接的一方收到对方的零窗口通知，就启动持续计时器

若持续计时器设置的时间到期，就发送一个零窗口探测报文段。接收方收到探测报文段时给出现在的窗口值。

若窗口仍然是0，那么发送方就重新设置持续计时器

<br/><br/><br/><br/>

#### （5）TCP拥塞控制

<br/>

出现拥塞得条件：对资源需求得总和 > 可用资源

网络中有许多资源同时呈现供应不足 —>  网络性能变坏 —>  网络吞吐量将随输入负荷增大而下降

拥塞控制：防止过多得数据注入到网络中。（全局性）

<br/>

拥塞控和流量控制的区别：

- 拥塞控制是多个发送方同时向接收方发送数据，接收方可以查觉到拥塞，但不能确定是哪一个发送方导致的拥塞；流量控制是点对点，当出现拥塞时，可以知道是谁导致的，对其进行控制就能解决。所以拥塞控制是全局性的，而流量控制是点对点的。

<br/>

拥塞控制的几种方法：

慢开始，拥塞避免；快重传，快恢复

<br/>

假定：

- 数据单方向传送，而另一个方向只传送确认

- 接收方总是有足够大的缓存空间，因而发送窗口大小取决于拥塞程度

  发送窗口 = Min{接收窗口rwnd，拥塞窗口cwnd}

接收窗口：接收方根据接收缓存设置的值，并告知给发送方，反应接收方容量

拥塞窗口：发送方根据自己估算的网络拥塞程度而设置的窗口值，反应网络当前容量

<br/>

慢开始，拥塞避免

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet129.png" alt="image-20211119152349738" style="zoom: 67%;" />

<br/>

传输轮次：发送了一批报文段并接收到他们确认的时间（一个往返时延RTT），开始发送一批拥塞窗口内的报文段到开始发送下一批拥塞窗口内的报文段的时间。

开始以指数规律增长，当到达ssthresh初始值时，每轮次增加1，到达网络拥塞值后，直接恢复为1，继续以指数增长，这时ssthresh变为拥塞值得一半，到达ssthresh后，每轮次增加1，重复此过程

<br/><br/>

快重传，快恢复

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet130.png" alt="image-20211119153119573" style="zoom:67%;" />

<br/>

这个与慢重传时类似的，只是在到达拥塞后，不是恢复到1，而是恢复到ssthresh，不断重复这个过程。

<br/><br/><br/><br/><br/><br/><br/><br/>

## （六）应用层

<br/>

### 1.概述

<br/>

应用层：对应用程序的通信提供服务

<br/>

应用层协议需要定义：

- 应用进程交换的报文类型，请求还是响应
- 各种报文段类型的语法，如报文中和字段和其详细描述
- 字段中的语义，即包含在该字段中的信息的含义
- 进程何时，如何发送报文，以及对报文的响应规则

<br/>

应用层的功能：

- 文件传输，访问和管理
- 电子邮件
- 虚拟终端
- 查询服务和远程作业登录

<br/>

一些重要协议：FTP，SMTP，POP3，HTTP，DNS

<br/><br/>

**客户/服务器（C/S）模型**

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet133.png" alt="image-20211120120420352" style="zoom:67%;" />

<br/>

服务器：提供计算服务的设备

特点：

- 永久提供服务
- 永久性访问地址/域名

<br/>

客户机：请求计算服务的主机

特点：

- 与服务器进行通信，使用服务器提供的服务
- 间歇性接入网络
- 可以使用动态IP地址
- 不与其他主机进行直接通信

<br/>

应用：Web，文件传输FTP，远程登录，电子邮件

<br/><br/>

**P2P模型**

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet132.png" alt="image-20211120120344159" style="zoom:67%;" />

<br/>

特点：

- 不存在永远在线的服务器
- 每个主机可以提供服务，也可以请求服务
- 任意端系统/节点之间可以直接通讯
- 节点间歇性接入网络
- 节点可能改变IP地址
- 可扩展性好
- 网络健壮性强

<br/><br/><br/><br/>

### 2.域名解析系统DNS

<br/>

DNS域名解析：主机输入网址后，会先去DNS服务器中去找对应IP地址，找到后再通过IP地址进行访问

<br/>

#### （1）域名

<br/>

![image-20211120122002031](https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet135.png)

<br/>

域名是从后到前依次为顶级域名，二级域名，三级域名.....

在顶级域名的后面实际还有一个点，代表根

不同等级之间的域名有些是可以相同的

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet136.png" alt="image-20211120122214608" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （2）域名服务器

<br/>

上层域名服务器记录的是一些直接的域名ip地址和下级服务器的ip地址，当在上级中找不到域名对应的ip地址，就会根据域名找到下一级域名服务器的ip地址再到向下一级进行查找，不断重复直到找到或到最后一级也找不到

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet137.png" alt="image-20211120122449610" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （3）域名解析过程

<br/>

分为递归查询和迭代查询

<br/>

递归查询：假如是主机对要访问的域名没有记录，主机首先向根域名发出查找请求，根域名对此域名进行查找，如果找到就直接将ip地址发给主机，如果没找到就根据域名后面的顶级域名，通过自己对这种顶级域名ip地址的记录直接对这个顶级域名服务器发出查找请求，顶级域名服务器如果找到就将这个ip地址发给根服务器再由跟服务器发送给主机，如果没找到，就根据二级域名继续向下一级服务器查找，不断重复这个操作。

迭代查询：假如主机对要访问的域名没有记录，主机首先向根域名服务器发出查找请求，根域名对此域名进行查找，如果找到就直接将ip地址发给主机，如果没找到就将域名后面的顶级域名服务器的ip地址发给主机，主机再通过顶级域名服务器的ip地址向顶级域名服务器发出查找请求，再通过顶级域名服务器进行查找，如果找到就将ip地址直接发给主机，如果没找到，不断重复这个操作。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet139.png" alt="image-20211120124457924" style="zoom:80%;" />

<br/><br/><br/><br/>

### 3.文件传送协议FTP

<br/>

FTP：提供不同种类主机系统（硬，软件体系等都可以）之间的文件传输能力，是internet文件传输的基础，目标是提高文件的共享性

TFTP：简单文件传送协议

<br/>

简单来说FTP就是两台计算机之间的拷贝

从远程计算机文件拷贝到本地计算机就是下载

将本地计算级的文件拷贝到远程计算机就是上传

<br/><br/>

**FTP服务器和用户端**

<br/>

FTP是基于客户/服务器（C/S）的协议

用户通过一个客户机程序连接至在远程计算机上运行的服务器程序

依照FTP协议提供服务，进行文件传送的计算机就是FTP服务器

连接FTP服务器，遵循FTP协议与服务器传送文件的电脑就是FTP客户端

<br/><br/>

**FTP用户授权**

<br/>

1）用户授权

要连接上FTP服务器，必须要由该FTP服务器授权的账号，也就是说你只要在有了一个用户标识和一个口令之后才能登录FTP服务器，享受FTP服务器的服务

2）FTP地址格式

ftp://用户名：密码@FTP服务器IP或域名：FTP命令端口/路径/文件名

3）匿名FTP

互联网中有很大一部风FTP服务器被称为匿名FTP服务器。这类服务器的目的是向公众提供文件拷贝服务，不要求用户实现在该服务器中进行的登录。Anonymous（匿名文件传输）能够使用户在匿名下与远程主机建立连接并从远程主机中下载文件。用户名使用特殊的用户名“anonymous”登录FTP服务，就可以访问远程主机上公开的问价。

<br/><br/>

**文件传输方式**

<br/>

FTP的传输有两种方式：ASCII传输模式和二进制数据传输模式。

1．ASCII传输方式：假定用户正在拷贝的文件包含的简单ASCII码文本，如果在远程机器上运行的不是UNIX，当文件传输时ftp通常会自动地调整文件的内容以便于把文件解释成另外那台计算机存储文本文件的格式。但是常常有这样的情况，用户正在传输的文件包含的不是文本文件，它们可能是程序，数据库，字处理文件或者压缩文件（尽管字处理文件包含的大部分是文本，其中也包含有指示页尺寸，字库等信息的非打印符）。在拷贝任何非文本文件之前，用binary 命令告诉ftp逐字拷贝，不要对这些文件进行处理，这也是下面要讲的二进制传输。

2．二进制传输模式：在二进制传输中，保存文件的位序，以便原始和拷贝的是逐位一一对应的。即使目的地机器上包含位序列的文件是没意义的。例如，macintosh以二进制方式传送可执行文件到Windows系统，在对方系统上，此文件不能执行。如果你在ASCII方式下传输二进制文件，即使不需要也仍会转译。这会使传输稍微变慢 ，也会损坏数据，使文件变得不能用。（在大多数计算机上，ASCII方式一般假设每一字符的第一有效位无意义，因为ASCII字符组合不使用它。如果你传输二进制文件，所有的位都是重要的。）如果你知道这两台机器是同样的，则二进制方式对文本文件和数据文件都是有效的。

<br/><br/>

**FTP工作方式**

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet140.png" alt="image-20211120131620150" style="zoom:67%;" />

<br/>

FTP的控制连接始终保持，数据连接保持一会

是否使用TCP 20端口建立数据连接与传输模式有关。

主动连接使用TCP 20，被动连接由服务器和客户端自行协商决定

<br/>

FTP支持两种模式，一种方式叫做Standard (也就是 PORT方式，主动方式)，一种是 Passive (也就是PASV，被动方式)。 Standard模式 FTP的客户端发送 PORT 命令到FTP服务器。Passive模式FTP的客户端发送 PASV命令到 FTP Server。

下面介绍一个这两种方式的工作原理：

Port模式FTP 客户端首先和FTP服务器的TCP 21端口建立连接，通过这个通道发送命令，客户端需要接收数据的时候在这个通道上发送PORT命令。 PORT命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的TCP 20端口连接至客户端的指定端口发送数据。 FTP server必须和客户端建立一个新的连接用来传送数据。

Passive模式在建立控制通道的时候和Standard模式类似，但建立连接后发送的不是Port命令，而是Pasv命令。FTP服务器收到Pasv命令后，随机打开一个高端端口（端口号大于1024）并且通知客户端在这个端口上传送数据的请求，客户端连接FTP服务器此端口，然后FTP服务器将通过这个端口进行数据的传送，这个时候FTP server不再需要建立一个新的和客户端之间的连接。

很多防火墙在设置的时候都是不允许接受外部发起的连接的，所以许多位于防火墙后或内网的FTP服务器不支持PASV模式，因为客户端无法穿过防火墙打开FTP服务器的高端端口；而许多内网的客户端不能用PORT模式登陆FTP服务器，因为从服务器的TCP 20无法和内部网络的客户端建立一个新的连接，造成无法工作。

<br/><br/><br/><br/>

### 4.电子邮件

<br/>

#### （1）概述

<br/>

**信息格式**

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet141.png" alt="image-20211120131808974" style="zoom:67%;" />

<br/><br/>

**组成结构**

<br/>

用户代理，邮件服务器，组成结构

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet142.png" alt="image-20211120131912298" style="zoom:80%;" />

<br/><br/><br/><br/>

#### （2）简单邮件传送协议SMTP

<br/>

SMTP规定了在两个相互通信的SMTP进程之间如何交换信息

负责发送邮件的SMTP进程就是SMTP客户，负责接收邮件的进程就是SMTP服务器

SMTP规定了14条命令（几个字母）和21种应答消息（三位数字代码+简单文字说明）

<br/>

TCP连接，端口号25，采用C/S

<br/>

SMTP通信的三个阶段：

连接建立 —>  邮件发送  —>  连接释放

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet143.png" alt="image-20211120132456438" style="zoom:67%;" />

<br/>

SMTP的缺点：

- SMTP不能传送可执行文件或者其他二进制对象
- SMTP仅限于传送7位ASCII码，不能传送其他非英语国家的文字
- SMTP服务器会拒绝超过一定长度的邮件

<br/><br/><br/><br/>

#### （3）通用因特网邮件扩充MIME

<br/>

为了解决SMTP文件的只能传送ASCII码的问题，采用MIME工具，让一些原本不可传送的数据首先转化为ASCII码，再发送，最后在接收端转化为原本的数据

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet144.png" alt="image-20211120133045820" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （4）邮局协议POP3

<br/>

采用TCP连接，端口号110，运用C/S

POP3的工作方式：下载并保留（在服务器），下载并删除

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet145.png" alt="image-20211120133327000" style="zoom:67%;" />

<br/><br/><br/><br/>

#### （5）网际报文存取协议IMAP

<br/>

IMAP协议要比POP协议复杂，当用户PC上的IMAP客户程序打开IMAP服务器的邮箱时，用户可以看到邮箱的首部，若用户需要打开某个邮件，该邮件才会上传到用户的计算机上

IMAP可以让用户在不同的地方使用不同的计算机随机上网阅读处理邮件，还允许只读邮件中的某一个部分，比如：先看正文，由wifi的时候在下载附件

<br/><br/><br/><br/>

### 5.万维网和HTTP协议

<br/>

#### （1）万维网概述

<br/>

万维网WWW是一个大规模的，联机式的信息储藏所/资料空间，是无数个网络站点和网页的集合

<br/>

一个URL唯一标识一个资源

<br/>

URL的一般格式：

<协议>：//<主机>：<端口>/<路径>

<br/>

用户通过点击超链接获取资源，这些资源通过超文本传输协议（HTTP）传送给使用者。

万维网以客户/服务器方式工作，用户使用的浏览器就是万维网客户程序，万维网文档所驻留的主机运行服务器程序。

万维网使用超文本标记语言HTML，使得万维网页面设计者可以很方便地从一个界面的链接转到另一个界面，并能够在自己的屏幕上显示出来

<br/><br/><br/><br/>

#### （2）超文本传输协议HTTP

<br/>

HTTP协议定义了浏览器（万维网客户进程）怎样向万维网服务器请求万维网文档，以及服务器怎样把文档发送给浏览器。

<br/>

用户浏览页面的方法：输入URL或点击超链接

具体过程：

- 浏览器分析URL
- 浏览器向DNS请求地址解析IP地址
- DNS解析出IP地址
- 浏览器与服务器之间建立TCP连接
- 浏览器发出取文件命令
- 服务器响应
- 释放TCP连接
- 浏览器显示

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet146.png" alt="image-20211120135321917" style="zoom:80%;" />

<br/><br/>

HTTP协议的特点：

- HTTP协议是无状态的
- 在一些实际工作中，浏览器常常希望可以识别用户，由此使用Cookie，Cookie是存储在用户主机上的文本文件，记录一段时间内某用户的房屋内记录，由此提供个性化服务
- HTTP采用TCP作为运输层协议，但HTTP协议本身是无连接的（通信双方在交换HTTP报文之前不需要建立HTTP连接）

<br/>

HTTP连接方式分为：持久连接（Keep-alive）和非持久性连接（Close）

非持久连接：当需要传输一个文件时建立一次连接，文件传输完成后释放连接

持久性连接：当需要传输文件时，只要自己不释放就可以一直传输文件

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet147.png" alt="image-20211120140012069" style="zoom: 67%;" />

<br/><br/>

**报文结构**

<br/>

HTTP报文分为：请求报文和响应报文

HTTP报文是面向文本的，因此在报文中每一个字段都是一些ASCII码串。

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet148.png" alt="image-20211120140242612" style="zoom:67%;" />

<br/>

一些状态码:

<br/>

<img src="https://cdn.jsdelivr.net/gh/hemeilun/picture/compunet149.png" alt="image-20211120140334067" style="zoom:67%;" />

<br/><br/><br/><br/>